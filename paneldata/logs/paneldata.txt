------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\mangelo.EEG\Documents\GitHub\R_Training\paneldata\logs\paneldata.txt
  log type:  text
 opened on:  29 Jun 2021, 15:11:57
r; t=0.01 15:11:57

. 
. timer on 1
r; t=0.00 15:11:57

. 
. // # 1. build simulated data: 10000 observations
. 
.         set obs 5000                    //      define the number of observations
number of observations (_N) was 0, now 5,000
r; t=0.00 15:11:57

.         set seed 345567789              //      define the 'seed' in order to be able
r; t=0.00 15:11:57

.                                                         //      to replicate the results
. 
.         // # 1.1. define worker's id and year of observation
. 
.                 gen workerid = int(_n/10.1)+1
r; t=0.00 15:11:57

.                 bysort workerid: gen year = _n
r; t=0.00 15:11:57

. 
.                 sort workerid year
r; t=0.00 15:11:57

.                 xtset workerid year
       panel variable:  workerid (unbalanced)
        time variable:  year, 1 to 11
                delta:  1 unit
r; t=0.01 15:11:57

. 
.         // # 1.2. generate individual's specific effect, ui
. 
.                 bysort workerid (year): gen double ui = runiform() if _n == 1
(4,504 missing values generated)
r; t=0.00 15:11:57

.                          bysort workerid (year): replace ui = ui[_n-1] if _n > 1
(4504 real changes made)
r; t=0.00 15:11:57

. 
.         // # 1.3. build the instrument, q1
. 
.                 bysort workerid (year): gen quarter= int(4*uniform()+1) if _n == 1
(4,504 missing values generated)
r; t=0.00 15:11:57

.                          bysort workerid (year): replace quarter = quarter[_n-1] if _n > 1
(4504 real changes made)
r; t=0.00 15:11:57

. 
.                         gen q1=(quarter==1)
r; t=0.00 15:11:57

. 
.         // # 1.4. build education and experience; education is a function of ui,
.                         // the worker specific effect, as well as the instrument, q1
. 
.                 bysort workerid (year): gen educ= int(16*runiform())*ui if _n == 1
(4,504 missing values generated)
r; t=0.00 15:11:57

.                         bysort workerid (year): replace educ= educ - 3*q1 if _n == 1
(119 real changes made)
r; t=0.00 15:11:57

. 
.                         bysort workerid (year): replace educ = educ[_n-1] + round(runiform()) if _n > 1
(4,504 real changes made)
r; t=0.00 15:11:57

.                                 sum educ, detail

                            educ
-------------------------------------------------------------
      Percentiles      Smallest
 1%      -2.1118             -3
 5%    -.1260787             -3
10%     .5240426             -3       Obs               5,000
25%     2.330317      -2.922136       Sum of Wgt.       5,000

50%     4.685726                      Mean           5.193152
                        Largest       Std. Dev.      3.914044
75%     7.689298       18.25217
90%      10.7564       18.30014       Variance       15.31974
95%     12.63449       18.44627       Skewness       .5687296
99%      15.5471       19.44627       Kurtosis       3.003111
r; t=0.00 15:11:57

.                         
.                         egen sd = sd(educ),by(workerid)
(1 missing value generated)
r; t=0.00 15:11:57

.                                 sum sd, detail

                             sd
-------------------------------------------------------------
      Percentiles      Smallest
 1%      .421637              0
 5%     .8232726              0
10%     .9660916              0       Obs               4,999
25%     1.229273              0       Sum of Wgt.       4,999

50%     1.595132                      Mean           1.610723
                        Largest       Std. Dev.      .5084654
75%      1.95789       3.316625
90%     2.299758       3.316625       Variance       .2585371
95%     2.440401       3.316625       Skewness        .006283
99%      2.65832       3.316625       Kurtosis       2.734078
r; t=0.00 15:11:57

.                                 drop sd
r; t=0.00 15:11:57

.                                 
.                                 recode educ min/0 = 0 20/max = 20
(educ: 281 changes made)
r; t=0.02 15:11:57

.                                         sum educ, detail

                            educ
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%     .5240426              0       Obs               5,000
25%     2.330317              0       Sum of Wgt.       5,000

50%     4.685726                      Mean           5.260554
                        Largest       Std. Dev.       3.80712
75%     7.689298       18.25217
90%      10.7564       18.30014       Variance       14.49416
95%     12.63449       18.44627       Skewness       .7024372
99%      15.5471       19.44627       Kurtosis         3.0027
r; t=0.00 15:11:57

. 
.                 bysort workerid (year): gen exper= int(20*uniform()) if _n == 1
(4,504 missing values generated)
r; t=0.00 15:11:57

.                         bysort workerid (year): replace exper = exper[_n-1] + 1 if _n > 1
(4504 real changes made)
r; t=0.00 15:11:57

. 
.                         gen exper2 = exper^2
r; t=0.00 15:11:57

.         
.         // # 1.5. union status
.         
.                 gen union = round(uniform(),1.0)
r; t=0.00 15:11:57

.                         
.                         tab union

      union |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,568       51.36       51.36
          1 |      2,432       48.64      100.00
------------+-----------------------------------
      Total |      5,000      100.00
r; t=0.00 15:11:57

. 
.         // # 1.6. generate the true log wage equation, where the error term is
.                                 // defined by 'uniform()/ln(600)'; 600 is the minimum wage
.         
.                 gen double lnwage = ln(600) + 0.06*educ + 0.007*exper - 0.00001*exper2 ///
>                                                         + 0.02*year + ui + uniform()/ln(600)
r; t=0.00 15:11:57

. 
.                         gen wage = exp(lnwage)
r; t=0.00 15:11:57

.                         
.                         egen nobs = count(workerid),by(workerid)
r; t=0.00 15:11:57

.                                 tab nobs

       nobs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1        0.02        0.02
         10 |      4,460       89.20       89.22
         11 |        539       10.78      100.00
------------+-----------------------------------
      Total |      5,000      100.00
r; t=0.00 15:11:57

.                                         drop if nobs < 10
(1 observation deleted)
r; t=0.00 15:11:57

.                                         
.                                                 drop nobs
r; t=0.00 15:11:57

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        495        9.90        9.90
          2 |        495        9.90       19.80
          3 |        495        9.90       29.71
          4 |        495        9.90       39.61
          5 |        495        9.90       49.51
          6 |        495        9.90       59.41
          7 |        495        9.90       69.31
          8 |        495        9.90       79.22
          9 |        495        9.90       89.12
         10 |        495        9.90       99.02
         11 |         49        0.98      100.00
------------+-----------------------------------
      Total |      4,999      100.00
r; t=0.00 15:11:57

. drop if year > 10
(49 observations deleted)
r; t=0.00 15:11:57

. tab year, ge(yy)

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        495       10.00       10.00
          2 |        495       10.00       20.00
          3 |        495       10.00       30.00
          4 |        495       10.00       40.00
          5 |        495       10.00       50.00
          6 |        495       10.00       60.00
          7 |        495       10.00       70.00
          8 |        495       10.00       80.00
          9 |        495       10.00       90.00
         10 |        495       10.00      100.00
------------+-----------------------------------
      Total |      4,950      100.00
r; t=0.00 15:11:57

. 
.         sort workerid year
r; t=0.00 15:11:57

.         xtset workerid year
       panel variable:  workerid (strongly balanced)
        time variable:  year, 1 to 10
                delta:  1 unit
r; t=0.01 15:11:57

.         
.         gen lag_lnwage = l.lnwage
(495 missing values generated)
r; t=0.00 15:11:57

. 
.         compress
  variable workerid was float now int
  variable year was float now byte
  variable quarter was float now byte
  variable q1 was float now byte
  variable exper was float now byte
  variable exper2 was float now int
  variable union was float now byte
  (94,050 bytes saved)
r; t=0.00 15:11:57

.         order workerid year ui quarter q1 wage educ exper union exper2 lnwage
r; t=0.00 15:11:57

.         sort workerid year
r; t=0.00 15:11:57

. 
.                                 save ../data/data_simulation, replace
file ../data/data_simulation.dta saved
r; t=0.00 15:11:57

. 
. // # 2. DESCRIPTIVE STATISTICS
. 
.                 describe

Contains data from ../data/data_simulation.dta
  obs:         4,950                          
 vars:            22                          29 Jun 2021 15:11
------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------------------------------------------------------------------------------------
workerid        int     %9.0g                 
year            byte    %9.0g                 
ui              double  %10.0g                
quarter         byte    %9.0g                 
q1              byte    %9.0g                 
wage            float   %9.0g                 
educ            float   %9.0g                 
exper           byte    %9.0g                 
union           byte    %9.0g                 
exper2          int     %9.0g                 
lnwage          double  %10.0g                
yy1             byte    %8.0g                 year== 1.0000
yy2             byte    %8.0g                 year== 2.0000
yy3             byte    %8.0g                 year== 3.0000
yy4             byte    %8.0g                 year== 4.0000
yy5             byte    %8.0g                 year== 5.0000
yy6             byte    %8.0g                 year== 6.0000
yy7             byte    %8.0g                 year== 7.0000
yy8             byte    %8.0g                 year== 8.0000
yy9             byte    %8.0g                 year== 9.0000
yy10            byte    %8.0g                 year== 10.0000
lag_lnwage      float   %9.0g                 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by: workerid  year
r; t=0.00 15:11:57

.                 codebook, compact

Variable     Obs Unique      Mean       Min       Max  Label
------------------------------------------------------------------------------------------------------------------------------------------------------------------
workerid    4950    495       248         1       495  
year        4950     10       5.5         1        10  
ui          4950    495  .4879205  .0004503  .9957856  
quarter     4950      4  2.517172         1         4  
q1          4950      2   .240404         0         1  
wage        4950   4950  1998.779  662.0831  7170.242  
educ        4950   2469  5.226306         0  19.44627  
exper       4950     29  14.33636         0        28  
union       4950      2  .4862626         0         1  
exper2      4950     29  247.2515         0       784  
lnwage      4950   4950  7.483222  6.495391  8.877695  
yy1         4950      2        .1         0         1  year==     1.0000
yy2         4950      2        .1         0         1  year==     2.0000
yy3         4950      2        .1         0         1  year==     3.0000
yy4         4950      2        .1         0         1  year==     4.0000
yy5         4950      2        .1         0         1  year==     5.0000
yy6         4950      2        .1         0         1  year==     6.0000
yy7         4950      2        .1         0         1  year==     7.0000
yy8         4950      2        .1         0         1  year==     8.0000
yy9         4950      2        .1         0         1  year==     9.0000
yy10        4950      2        .1         0         1  year==    10.0000
lag_lnwage  4455   4454  7.454981  6.495391  8.723684  
------------------------------------------------------------------------------------------------------------------------------------------------------------------
r; t=0.08 15:11:57

.                 
.                 sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    workerid |      4,950         248    142.9083          1        495
        year |      4,950         5.5    2.872571          1         10
          ui |      4,950    .4879205    .2885151   .0004503   .9957856
     quarter |      4,950    2.517172    1.127912          1          4
          q1 |      4,950     .240404     .427372          0          1
-------------+---------------------------------------------------------
        wage |      4,950    1998.779    1032.194   662.0831   7170.242
        educ |      4,950    5.226306    3.794824          0   19.44627
       exper |      4,950    14.33636     6.45977          0         28
       union |      4,950    .4862626    .4998617          0          1
      exper2 |      4,950    247.2515    187.1262          0        784
-------------+---------------------------------------------------------
      lnwage |      4,950    7.483222    .4763188   6.495391   8.877695
         yy1 |      4,950          .1    .3000303          0          1
         yy2 |      4,950          .1    .3000303          0          1
         yy3 |      4,950          .1    .3000303          0          1
         yy4 |      4,950          .1    .3000303          0          1
-------------+---------------------------------------------------------
         yy5 |      4,950          .1    .3000303          0          1
         yy6 |      4,950          .1    .3000303          0          1
         yy7 |      4,950          .1    .3000303          0          1
         yy8 |      4,950          .1    .3000303          0          1
         yy9 |      4,950          .1    .3000303          0          1
-------------+---------------------------------------------------------
        yy10 |      4,950          .1    .3000303          0          1
  lag_lnwage |      4,455    7.454981    .4697752   6.495391   8.723684
r; t=0.00 15:11:57

.                 inspect educ

educ:                                           Number of Observations
-------                                ---------------------------------------
                                             Total      Integers   Nonintegers
|  #                         Negative            -             -             -
|  #                         Zero              333           333             -
|  #   #                     Positive        4,617           205         4,412
|  #   #                               -----------   -----------   -----------
|  #   #   #                 Total           4,950           538         4,412
|  #   #   #   .   .         Missing             -
+----------------------                -----------
0              19.44627                      4,950
(More than 99 unique values)
r; t=0.00 15:11:57

.                 
.                 xtdes

workerid:  1, 2, ..., 495                                    n =        495
    year:  1, 2, ..., 10                                     T =         10
           Delta(year) = 1 unit
           Span(year)  = 10 periods
           (workerid*year uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                        10      10      10        10        10      10      10

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+------------
      495    100.00  100.00 |  1111111111
 ---------------------------+------------
      495    100.00         |  XXXXXXXXXX
r; t=0.06 15:11:57

.                 xtsum

Variable         |      Mean   Std. Dev.       Min        Max |    Observations
-----------------+--------------------------------------------+----------------
workerid overall |       248   142.9083          1        495 |     N =    4950
         between |             143.0385          1        495 |     n =     495
         within  |                    0        248        248 |     T =      10
                 |                                            |
year     overall |       5.5   2.872571          1         10 |     N =    4950
         between |                    0        5.5        5.5 |     n =     495
         within  |             2.872571          1         10 |     T =      10
                 |                                            |
ui       overall |  .4879205   .2885151   .0004503   .9957856 |     N =    4950
         between |             .2887778   .0004503   .9957856 |     n =     495
         within  |             6.72e-17   .4879205   .4879205 |     T =      10
                 |                                            |
quarter  overall |  2.517172   1.127912          1          4 |     N =    4950
         between |             1.128938          1          4 |     n =     495
         within  |                    0   2.517172   2.517172 |     T =      10
                 |                                            |
q1       overall |   .240404    .427372          0          1 |     N =    4950
         between |             .4277611          0          1 |     n =     495
         within  |                    0    .240404    .240404 |     T =      10
                 |                                            |
wage     overall |  1998.779   1032.194   662.0831   7170.242 |     N =    4950
         between |             958.4146   766.2481   5339.549 |     n =     495
         within  |             385.4032   649.9505   3915.021 |     T =      10
                 |                                            |
educ     overall |  5.226306   3.794824          0   19.44627 |     N =    4950
         between |             3.469262          0   15.55874 |     n =     495
         within  |             1.544925   .7263063   9.726306 |     T =      10
                 |                                            |
exper    overall |  14.33636    6.45977          0         28 |     N =    4950
         between |             5.791196        4.5       23.5 |     n =     495
         within  |             2.872571   9.836364   18.83636 |     T =      10
                 |                                            |
union    overall |  .4862626   .4998617          0          1 |     N =    4950
         between |             .1606325          0         .9 |     n =     495
         within  |             .4733982  -.4137374   1.386263 |     T =      10
                 |                                            |
exper2   overall |  247.2515   187.1262          0        784 |     N =    4950
         between |              164.694       28.5      560.5 |     n =     495
         within  |             89.11484   47.75152   470.7515 |     T =      10
                 |                                            |
lnwage   overall |  7.483222   .4763188   6.495391   8.877695 |     N =    4950
         between |             .4451129   6.635227   8.569953 |     n =     495
         within  |             .1706296   7.071283    7.89532 |     T =      10
                 |                                            |
yy1      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy2      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy3      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy4      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy5      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy6      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy7      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy8      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy9      overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
yy10     overall |        .1   .3000303          0          1 |     N =    4950
         between |                    0         .1         .1 |     n =     495
         within  |             .3000303          0          1 |     T =      10
                 |                                            |
lag_ln~e overall |  7.454981   .4697752   6.495391   8.723684 |     N =    4455
         between |             .4441482   6.616816   8.537238 |     n =     495
         within  |              .154193   7.084852   7.870631 |     T =       9
r; t=0.07 15:11:57

.                 
.                         gen educ_int = round(educ,1.0)
r; t=0.00 15:11:57

. 
.         xttab educ_int

                  Overall             Between            Within
 educ_int |    Freq.  Percent      Freq.  Percent        Percent
----------+-----------------------------------------------------
        0 |     491      9.92       135     27.27          36.37
        1 |     394      7.96       199     40.20          19.80
        2 |     447      9.03       245     49.49          18.24
        3 |     563     11.37       278     56.16          20.25
        4 |     519     10.48       290     58.59          17.90
        5 |     495     10.00       279     56.36          17.74
        6 |     425      8.59       247     49.90          17.21
        7 |     339      6.85       207     41.82          16.38
        8 |     310      6.26       177     35.76          17.51
        9 |     251      5.07       149     30.10          16.85
       10 |     180      3.64       118     23.84          15.25
       11 |     140      2.83        90     18.18          15.56
       12 |     133      2.69        67     13.54          19.85
       13 |     109      2.20        57     11.52          19.12
       14 |      63      1.27        40      8.08          15.75
       15 |      42      0.85        22      4.44          19.09
       16 |      26      0.53        14      2.83          18.57
       17 |      15      0.30        12      2.42          12.50
       18 |       7      0.14         7      1.41          10.00
       19 |       1      0.02         1      0.20          10.00
----------+-----------------------------------------------------
    Total |    4950    100.00      2634    532.12          18.79
                               (n = 495)
r; t=0.03 15:11:57

.         xttab union

                  Overall             Between            Within
    union |    Freq.  Percent      Freq.  Percent        Percent
----------+-----------------------------------------------------
        0 |    2543     51.37       495    100.00          51.37
        1 |    2407     48.63       494     99.80          48.72
----------+-----------------------------------------------------
    Total |    4950    100.00       989    199.80          50.05
                               (n = 495)
r; t=0.03 15:11:57

. 
.         xttrans educ_int

           |                                                              educ_int
  educ_int |         0          1          2          3          4          5          6          7          8          9         10         11 |     Total
-----------+------------------------------------------------------------------------------------------------------------------------------------+----------
         0 |     73.71      26.29       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         1 |      0.00      50.78      49.22       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         2 |      0.00       0.00      47.09      52.91       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         3 |      0.00       0.00       0.00      52.97      47.03       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         4 |      0.00       0.00       0.00       0.00      48.83      51.17       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         5 |      0.00       0.00       0.00       0.00       0.00      49.32      50.68       0.00       0.00       0.00       0.00       0.00 |    100.00 
         6 |      0.00       0.00       0.00       0.00       0.00       0.00      48.63      51.37       0.00       0.00       0.00       0.00 |    100.00 
         7 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00      45.99      54.01       0.00       0.00       0.00 |    100.00 
         8 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00      49.44      50.56       0.00       0.00 |    100.00 
         9 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00      48.11      51.89       0.00 |    100.00 
        10 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00      42.47      57.53 |    100.00 
        11 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00      45.05 |    100.00 
        12 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        13 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        14 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        15 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        16 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        17 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        18 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
-----------+------------------------------------------------------------------------------------------------------------------------------------+----------
     Total |      7.99       7.23       8.78      11.49      10.82      10.24       8.98       7.18       6.46       5.34       3.86       3.01 |    100.00 


           |                                        educ_int
  educ_int |        12         13         14         15         16         17         18         19 |     Total
-----------+----------------------------------------------------------------------------------------+----------
         0 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         1 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         2 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         3 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         4 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         5 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         6 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         7 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         8 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
         9 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        10 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        11 |     54.95       0.00       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        12 |     56.41      43.59       0.00       0.00       0.00       0.00       0.00       0.00 |    100.00 
        13 |      0.00      56.52      43.48       0.00       0.00       0.00       0.00       0.00 |    100.00 
        14 |      0.00       0.00      51.11      48.89       0.00       0.00       0.00       0.00 |    100.00 
        15 |      0.00       0.00       0.00      58.82      41.18       0.00       0.00       0.00 |    100.00 
        16 |      0.00       0.00       0.00       0.00      50.00      50.00       0.00       0.00 |    100.00 
        17 |      0.00       0.00       0.00       0.00       0.00      30.00      70.00       0.00 |    100.00 
        18 |      0.00       0.00       0.00       0.00       0.00       0.00       0.00     100.00 |    100.00 
-----------+----------------------------------------------------------------------------------------+----------
     Total |      2.85       2.31       1.41       0.94       0.58       0.34       0.16       0.02 |    100.00 
r; t=0.01 15:11:57

.         xttrans union

           |         union
     union |         0          1 |     Total
-----------+----------------------+----------
         0 |     51.76      48.24 |    100.00 
         1 |     51.62      48.38 |    100.00 
-----------+----------------------+----------
     Total |     51.69      48.31 |    100.00 
r; t=0.00 15:11:57

. 
.                         preserve
r; t=0.00 15:11:57

.                                 collapse (mean) mean_educ = educ (count) educ,by(workerid)
r; t=0.03 15:11:57

.                                 sum mean_educ educ if mean_educ ~= .

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   mean_educ |        495    5.226306    3.469262          0   15.55874
        educ |        495          10           0         10         10
r; t=0.00 15:11:57

.                         restore
r; t=0.00 15:11:57

. 
.                                 tabstat educ,by(union)

Summary for variables: educ
     by categories of: union 

   union |      mean
---------+----------
       0 |  5.332972
       1 |  5.113613
---------+----------
   Total |  5.226306
--------------------
r; t=0.01 15:11:57

.                                 sum educ, detail

                            educ
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%     .5167809              0       Obs               4,950
25%     2.321574              0       Sum of Wgt.       4,950

50%     4.645773                      Mean           5.226306
                        Largest       Std. Dev.      3.794824
75%     7.635435       18.25217
90%     10.69205       18.30014       Variance       14.40069
95%     12.63092       18.44627       Skewness         .71088
99%     15.47818       19.44627       Kurtosis       3.019608
r; t=0.00 15:11:57

.                                         scalar median_educ = r(p50)
r; t=0.00 15:11:57

. 
.         // # 2.1. export descriptive statistics & graphs
. 
.                                         preserve
r; t=0.01 15:11:57

.                                                 set dp comma
r; t=0.00 15:11:57

.                                                         tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        495       10,00       10,00
          2 |        495       10,00       20,00
          3 |        495       10,00       30,00
          4 |        495       10,00       40,00
          5 |        495       10,00       50,00
          6 |        495       10,00       60,00
          7 |        495       10,00       70,00
          8 |        495       10,00       80,00
          9 |        495       10,00       90,00
         10 |        495       10,00      100,00
------------+-----------------------------------
      Total |       4950      100,00
r; t=0.00 15:11:57

.                                                                 sum year

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |      4.950         5,5    2,872571          1         10
r; t=0.00 15:11:57

.                                                                 
.                                                         keep if year == r(max)
(4.455 observations deleted)
r; t=0.00 15:11:57

.                                                         
.                                                         format %12.3f wage educ exper
r; t=0.00 15:11:57

.                                                         
.                                         estpost summarize wage educ exper

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
        wage |       495        495   2552,995    1553284   1246,308   884,9926   7170,242    1263732 
        educ |       495        495   7,455474   14,17742   3,765292          0   19,44627   3690,459 
       exper |       495        495   18,83636   33,53795   5,791196          9         28       9324 
r; t=0.01 15:11:57

.                                         esttab using ../tex_paper/summary_statistics.tex, replace ///
>                                                 cells("count mean sd min max") nonumbers noobs label ///
>                                                 nomtitles nonotes addnotes("Source: own computations.")
(output written to ../tex_paper/summary_statistics.tex)
r; t=0.05 15:11:57

.                                                 
.                                                 set dp period
r; t=0.00 15:11:57

.                                         restore
r; t=0.00 15:11:57

. 
.                                         preserve
r; t=0.01 15:11:57

.                                                 collapse (mean) mean_educ = educ mean_wage = wage,by(year)
r; t=0.01 15:11:57

.                                                 gen ln_mean_wage = ln(mean_wage)
r; t=0.00 15:11:57

.                                                 
.                                                 label var mean_educ "Average education"
r; t=0.00 15:11:57

.                                                 label var ln_mean_wage "Ln Average WAGE"
r; t=0.00 15:11:57

.                                                 
.                                                 sum year

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |         10         5.5     3.02765          1         10
r; t=0.00 15:11:57

.                                                 local mm = r(min)
r; t=0.00 15:11:57

.                                                 local jj = r(max)
r; t=0.00 15:11:57

.                                                 twoway (line mean_educ year, yaxis(1)) || (line ln_mean_wage year, yaxis(2) title("`mm' - `jj'")), ///
>                                                         scheme(sj) title("") graphregion(color(white)) legend(region(color(white)))
r; t=1.35 15:11:58

.                                                         
.                                                         graph export ../tex_paper/figures/mean_education_wage_year.png, replace
(file ../tex_paper/figures/mean_education_wage_year.png written in PNG format)
r; t=0.23 15:11:59

.                                                         graph export ../tex_paper/figures/mean_education_wage_year.eps, replace
(file ../tex_paper/figures/mean_education_wage_year.eps written in EPS format)
r; t=0.01 15:11:59

.                                         restore
r; t=0.00 15:11:59

. 
.                                                 sum year

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |      4,950         5.5    2.872571          1         10
r; t=0.00 15:11:59

.                                                 local mm = r(min)
r; t=0.00 15:11:59

.                                                 local jj = r(max)
r; t=0.00 15:11:59

.                                         
.                                         twoway kdensity lnwage if educ <= median_educ,legend(on label(1 "Low education")) || kdensity lnwage if educ > median_ed
> uc, /*
>                                                 */ legend(on label(2 "High education")) title("`mm' - `jj'") scheme(s2mono) graphregion(color(white)) xtitle("Ln
>  GDP") /*
>                                                 */ ytitle("Density") legend(region(lcolor(white))) legend(region(color(white)))
r; t=1.12 15:12:00

. 
.                                                 graph export ../tex_paper/figures/lnwage_education.png, replace                                 
(file ../tex_paper/figures/lnwage_education.png written in PNG format)
r; t=0.20 15:12:00

.                                                 graph export ../tex_paper/figures/lnwage_education.eps, replace
(file ../tex_paper/figures/lnwage_education.eps written in EPS format)
r; t=0.01 15:12:00

. 
. 
. // # 3. REGRESSIONS
. 
.         // # 3.1 OLS
. 
.                 reg lnwage educ exper exper2

      Source |       SS           df       MS      Number of obs   =     4,950
-------------+----------------------------------   F(3, 4946)      =   4816.20
       Model |  836.484454         3  278.828151   Prob > F        =    0.0000
    Residual |  286.342723     4,946  .057893798   R-squared       =    0.7450
-------------+----------------------------------   Adj R-squared   =    0.7448
       Total |  1122.82718     4,949  .226879607   Root MSE        =    .24061

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1068496   .0009107   117.33   0.000     .1050643    .1086349
       exper |    .012856   .0021981     5.85   0.000     .0085467    .0171654
      exper2 |  -.0002784   .0000759    -3.67   0.000    -.0004272   -.0001295
       _cons |   6.809309   .0150119   453.59   0.000      6.77988    6.838739
------------------------------------------------------------------------------
r; t=0.69 15:12:01

.                 reg lnwage educ exper exper2 i.year ui

      Source |       SS           df       MS      Number of obs   =     4,950
-------------+----------------------------------   F(13, 4936)     =  41579.11
       Model |  1112.66652        13  85.5897325   Prob > F        =    0.0000
    Residual |  10.1606539     4,936  .002058479   R-squared       =    0.9910
-------------+----------------------------------   Adj R-squared   =    0.9909
       Total |  1122.82718     4,949  .226879607   Root MSE        =    .04537

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0603151   .0002231   270.36   0.000     .0598777    .0607524
       exper |   .0071808   .0004214    17.04   0.000     .0063548    .0080069
      exper2 |  -.0000166   .0000145    -1.14   0.254     -.000045    .0000119
             |
        year |
          2  |   .0196232   .0028898     6.79   0.000      .013958    .0252885
          3  |   .0395306   .0029054    13.61   0.000     .0338346    .0452265
          4  |   .0542088   .0029283    18.51   0.000      .048468    .0599496
          5  |    .077908    .002957    26.35   0.000     .0721109    .0837051
          6  |   .0987031   .0029921    32.99   0.000     .0928372    .1045689
          7  |   .1162668   .0030333    38.33   0.000     .1103202    .1222134
          8  |   .1376893   .0030833    44.66   0.000     .1316448    .1437339
          9  |   .1556542   .0031387    49.59   0.000     .1495009    .1618074
         10  |   .1774313   .0032033    55.39   0.000     .1711513    .1837113
             |
          ui |   1.000896   .0027329   366.24   0.000     .9955385    1.006254
       _cons |   6.493085   .0033073  1963.24   0.000     6.486601    6.499569
------------------------------------------------------------------------------
r; t=0.02 15:12:01

. 
.                 reg lnwage educ exper exper2 i.year

      Source |       SS           df       MS      Number of obs   =     4,950
-------------+----------------------------------   F(12, 4937)     =   1202.26
       Model |  836.555976        12   69.712998   Prob > F        =    0.0000
    Residual |  286.271201     4,937  .057984849   R-squared       =    0.7450
-------------+----------------------------------   Adj R-squared   =    0.7444
       Total |  1122.82718     4,949  .226879607   Root MSE        =     .2408

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1071814   .0009699   110.51   0.000       .10528    .1090829
       exper |   .0130538   .0022348     5.84   0.000     .0086726    .0174349
      exper2 |  -.0002764    .000077    -3.59   0.000    -.0004274   -.0001254
             |
        year |
          2  |  -.0010307   .0153344    -0.07   0.946    -.0310929    .0290315
          3  |  -.0019753   .0154087    -0.13   0.898    -.0321832    .0282325
          4  |  -.0075769    .015516    -0.49   0.625    -.0379952    .0228413
          5  |  -.0041005   .0156491    -0.26   0.793    -.0347797    .0265788
          6  |  -.0048719   .0158093    -0.31   0.758    -.0358651    .0261214
          7  |   -.009027   .0159963    -0.56   0.573    -.0403868    .0223327
          8  |   -.010858    .016222    -0.67   0.503    -.0426603    .0209442
          9  |  -.0132949   .0164776    -0.81   0.420    -.0455983    .0190084
         10  |  -.0108864   .0167811    -0.65   0.517    -.0437847     .022012
             |
       _cons |   6.810622   .0169396   402.05   0.000     6.777413    6.843832
------------------------------------------------------------------------------
r; t=0.01 15:12:01

.                         est store OLS
r; t=0.00 15:12:01

.                         
.         // # 3.2 PANEL
. 
.                 // # 3.2.1 RANDOM EFFECTS
. 
.                         xtreg lnwage educ exper exper2 i.year, re theta

Random-effects GLS regression                   Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9358                                         min =         10
     between = 0.7200                                         avg =       10.0
     overall = 0.7156                                         max =         10

                                                Wald chi2(12)     =   63374.99
corr(u_i, X)   = 0 (assumed)                    Prob > chi2       =     0.0000
theta          = .93872661

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |    .066613   .0009368    71.11   0.000     .0647769    .0684491
       exper |   .0045286   .0019458     2.33   0.020     .0007148    .0083423
      exper2 |   4.21e-06   .0000199     0.21   0.832    -.0000347    .0000431
             |
        year |
          2  |   .0191379   .0035228     5.43   0.000     .0122334    .0260425
          3  |    .038422     .00484     7.94   0.000     .0289357    .0479083
          4  |   .0524424   .0064624     8.12   0.000     .0397764    .0651084
          5  |   .0753801   .0082121     9.18   0.000     .0592847    .0914754
          6  |   .0951217   .0100298     9.48   0.000     .0754637    .1147797
          7  |   .1115001   .0118837     9.38   0.000     .0882085    .1347917
          8  |   .1314197   .0137676     9.55   0.000     .1044357    .1584037
          9  |   .1481535   .0156547     9.46   0.000     .1174707    .1788362
         10  |   .1687269   .0175498     9.61   0.000       .13433    .2031238
             |
       _cons |   6.985087   .0217757   320.77   0.000     6.942407    7.027767
-------------+----------------------------------------------------------------
     sigma_u |  .23458928
     sigma_e |  .04554041
         rho |  .96368286   (fraction of variance due to u_i)
------------------------------------------------------------------------------
r; t=0.13 15:12:01

.                                         est store RE
r; t=0.00 15:12:01

.                                 
.                 // # 3.2.2 FIXED EFFECTS
. 
.                         // discuss why some time dummies are dropped
. 
.                         xtreg lnwage educ exper exper2, fe                      // omit the time dummies

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9360                                         min =         10
     between = 0.5415                                         avg =       10.0
     overall = 0.5860                                         max =         10

                                                F(3,4452)         =   21689.90
corr(u_i, Xb)  = 0.1886                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0624481   .0009583    65.16   0.000     .0605693    .0643269
       exper |   .0251958   .0007538    33.43   0.000     .0237181    .0266735
      exper2 |   5.45e-06    .000019     0.29   0.774    -.0000318    .0000427
       _cons |   6.794284   .0048313  1406.31   0.000     6.784813    6.803756
-------------+----------------------------------------------------------------
     sigma_u |  .30923658
     sigma_e |  .04552531
         rho |  .97878651   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 4452) = 270.66                 Prob > F = 0.0000
r; t=0.04 15:12:01

. 
.                         xtreg lnwage educ exper exper2 i.year, fe       // complete model
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9360                                         min =         10
     between = 0.5407                                         avg =       10.0
     overall = 0.5854                                         max =         10

                                                F(11,4444)        =    5911.96
corr(u_i, Xb)  = 0.1876                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0624152   .0009619    64.89   0.000     .0605295     .064301
       exper |   .0253104   .0008015    31.58   0.000     .0237391    .0268817
      exper2 |   3.55e-06   .0000195     0.18   0.855    -.0000346    .0000417
             |
        year |
          2  |   .0001748    .002753     0.06   0.949    -.0052224     .005572
          3  |   .0005613   .0026483     0.21   0.832    -.0046306    .0057533
          4  |  -.0043192   .0025799    -1.67   0.094    -.0093771    .0007388
          5  |  -.0002396   .0025466    -0.09   0.925    -.0052322     .004753
          6  |   .0008121   .0025459     0.32   0.750     -.004179    .0058033
          7  |  -.0014379   .0025792    -0.56   0.577    -.0064945    .0036187
          8  |   .0000387   .0026471     0.01   0.988    -.0051509    .0052283
          9  |  -.0018782   .0027525    -0.68   0.495    -.0072745    .0035181
         10  |          0  (omitted)
             |
       _cons |   6.793912   .0058888  1153.71   0.000     6.782367    6.805457
-------------+----------------------------------------------------------------
     sigma_u |  .30943273
     sigma_e |  .04554041
         rho |  .97879907   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 4444) = 270.45                 Prob > F = 0.0000
r; t=0.06 15:12:01

.                                 est store FE
r; t=0.00 15:12:01

.                                 
.                 // # 3.2.3 HAUSMAN test
. 
.                         hausman FE RE

Note: the rank of the differenced variance matrix (10) does not equal the number of coefficients being tested (11); be sure this is what you expect, or there may
        be problems computing the test.  Examine the output of your estimators for anything unexpected and possibly consider scaling your variables so that the
        coefficients are on a similar scale.

                 ---- Coefficients ----
             |      (b)          (B)            (b-B)     sqrt(diag(V_b-V_B))
             |       FE           RE         Difference          S.E.
-------------+----------------------------------------------------------------
        educ |    .0624152      .066613       -.0041978        .0002182
       exper |    .0253104     .0045286        .0207819               .
      exper2 |    3.55e-06     4.21e-06       -6.61e-07               .
        year |
          2  |    .0001748     .0191379       -.0189631               .
          3  |    .0005613      .038422       -.0378607               .
          4  |   -.0043192     .0524424       -.0567616               .
          5  |   -.0002396     .0753801       -.0756197               .
          6  |    .0008121     .0951217       -.0943096               .
          7  |   -.0014379     .1115001        -.112938               .
          8  |    .0000387     .1314197        -.131381               .
          9  |   -.0018782     .1481535       -.1500317               .
------------------------------------------------------------------------------
                           b = consistent under Ho and Ha; obtained from xtreg
            B = inconsistent under Ha, efficient under Ho; obtained from xtreg

    Test:  Ho:  difference in coefficients not systematic

                 chi2(10) = (b-B)'[(V_b-V_B)^(-1)](b-B)
                          =      311.31
                Prob>chi2 =      0.0000
                (V_b-V_B is not positive definite)
r; t=0.01 15:12:01

. 
.         // # 3.3 IV: cross-section
. 
.                 preserve
r; t=0.01 15:12:01

.                         bysort workerid (year): keep if _n==1           // cross-section
(4,455 observations deleted)
r; t=0.00 15:12:01

.                         
.                         xi: ivreg2 lnwage (educ = q1) exper exper2 i.year, first
i.year            _Iyear_1-1          (naturally coded; _Iyear_1 omitted)

First-stage regressions
-----------------------


First-stage regression of educ:

Statistics consistent for homoskedasticity only
Number of obs =                    495
------------------------------------------------------------------------------
        educ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          q1 |  -1.925479   .3248022    -5.93   0.000    -2.563652   -1.287305
       exper |  -.1254006   .0924319    -1.36   0.176    -.3070114    .0562103
      exper2 |   .0061944   .0047033     1.32   0.188    -.0030468    .0154355
       _cons |   4.023993    .391794    10.27   0.000     3.254194    4.793793
------------------------------------------------------------------------------
F test of excluded instruments:
  F(  1,   491) =    35.14
  Prob > F      =   0.0000
Sanderson-Windmeijer multivariate F test of excluded instruments:
  F(  1,   491) =    35.14
  Prob > F      =   0.0000



Summary results for first-stage regressions
-------------------------------------------

                                           (Underid)            (Weak id)
Variable     | F(  1,   491)  P-val | SW Chi-sq(  1) P-val | SW F(  1,   491)
educ         |      35.14    0.0000 |       35.43   0.0000 |       35.14

Stock-Yogo weak ID F test critical values for single endogenous regressor:
                                   10% maximal IV size             16.38
                                   15% maximal IV size              8.96
                                   20% maximal IV size              6.66
                                   25% maximal IV size              5.53
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Sanderson-Windmeijer F statistic.

Underidentification test
Ho: matrix of reduced form coefficients has rank=K1-1 (underidentified)
Ha: matrix has rank=K1 (identified)
Anderson canon. corr. LM statistic       Chi-sq(1)=33.06    P-val=0.0000

Weak identification test
Ho: equation is weakly identified
Cragg-Donald Wald F statistic                                      35.14

Stock-Yogo weak ID test critical values for K1=1 and L1=1:
                                   10% maximal IV size             16.38
                                   15% maximal IV size              8.96
                                   20% maximal IV size              6.66
                                   25% maximal IV size              5.53
Source: Stock-Yogo (2005).  Reproduced by permission.

Weak-instrument-robust inference
Tests of joint significance of endogenous regressors B1 in main equation
Ho: B1=0 and orthogonality conditions are valid
Anderson-Rubin Wald test           F(1,491)=       5.35     P-val=0.0211
Anderson-Rubin Wald test           Chi-sq(1)=      5.39     P-val=0.0202
Stock-Wright LM S statistic        Chi-sq(1)=      5.34     P-val=0.0209

Number of observations               N  =        495
Number of regressors                 K  =          4
Number of endogenous regressors      K1 =          1
Number of instruments                L  =          4
Number of excluded instruments       L1 =          1

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics consistent for homoskedasticity only

                                                      Number of obs =      495
                                                      F(  3,   491) =     4.59
                                                      Prob > F      =   0.0035
Total (centered) SS     =  94.46239836                Centered R2   =   0.5187
Total (uncentered) SS   =  26033.74243                Uncentered R2 =   0.9983
Residual SS             =  45.46376833                Root MSE      =    .3031

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0550889   .0165682     3.32   0.001     .0226158     .087562
       exper |   .0149673   .0092318     1.62   0.105    -.0031267    .0330613
      exper2 |  -.0005777   .0004694    -1.23   0.218    -.0014976    .0003423
       _cons |   6.994305   .0687991   101.66   0.000     6.859462    7.129149
------------------------------------------------------------------------------
Underidentification test (Anderson canon. corr. LM statistic):          33.063
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):               35.143
Stock-Yogo weak ID test critical values: 10% maximal IV size             16.38
                                         15% maximal IV size              8.96
                                         20% maximal IV size              6.66
                                         25% maximal IV size              5.53
Source: Stock-Yogo (2005).  Reproduced by permission.
------------------------------------------------------------------------------
Sargan statistic (overidentification test of all instruments):           0.000
                                                 (equation exactly identified)
------------------------------------------------------------------------------
Instrumented:         educ
Included instruments: exper exper2
Excluded instruments: q1
------------------------------------------------------------------------------
r; t=0.59 15:12:02

.                                 est store IV
r; t=0.00 15:12:02

.                 restore
r; t=0.00 15:12:02

. 
.         // # 3.4 PANEL + IV
. 
.                 // DISCUSS why education is dropped in the following regression
. 
.                 xtivreg lnwage (educ=q1) exper exper2 i.year, fe

Fixed-effects (within) IV regression            Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.8754                                         min =         10
     between = 0.0021                                         avg =       10.0
     overall = 0.0353                                         max =         10

                                                Wald chi2(10)     =   6.87e+07
corr(u_i, Xb)  = -0.5010                        Prob > chi2       =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |          0  (omitted)
       exper |   .0562305   .0008992    62.53   0.000      .054468    .0579929
      exper2 |  -.0000297   .0000272    -1.09   0.275    -.0000829    .0000236
             |
        year |
          2  |  -.0032195   .0038407    -0.84   0.402    -.0107471    .0043082
          3  |  -.0052048   .0036932    -1.41   0.159    -.0124433    .0020338
          4  |  -.0124606   .0035957    -3.47   0.001    -.0195079   -.0054132
          5  |  -.0100738   .0035471    -2.84   0.005     -.017026   -.0031216
          6  |  -.0081666   .0035471    -2.30   0.021    -.0151188   -.0012144
          7  |  -.0085997   .0035957    -2.39   0.017    -.0156471   -.0015524
          8  |  -.0025038   .0036932    -0.68   0.498    -.0097424    .0047348
          9  |  -.0028408   .0038407    -0.74   0.460    -.0103684    .0046869
         10  |          0  (omitted)
             |
       _cons |   6.689723   .0079056   846.20   0.000     6.674228    6.705218
-------------+----------------------------------------------------------------
     sigma_u |  .53655486
     sigma_e |    .063545
         rho |  .98616799   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F  test that all u_i=0:     F(494,4445) =   136.55        Prob > F    = 0.0000
------------------------------------------------------------------------------
Instrumented:   educ
Instruments:    exper exper2 2.year 3.year 4.year 5.year 6.year 7.year 8.year
                9.year 10.year q1
------------------------------------------------------------------------------
r; t=0.31 15:12:02

.                         est store FE_IV
r; t=0.00 15:12:02

.                         
.                 // COMPARE 'ivreg2' & 'xtivreg2, re' results
. 
.                 xtivreg lnwage (educ=q1) exper exper2 i.year, re

G2SLS random-effects IV regression              Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9355                                         min =         10
     between = 0.7191                                         avg =       10.0
     overall = 0.6881                                         max =         10

                                                Wald chi2(12)     =   55277.92
corr(u_i, X)       = 0 (assumed)                Prob > chi2       =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0562713   .0094353     5.96   0.000     .0377784    .0747642
       exper |   .0045157   .0018387     2.46   0.014     .0009119    .0081194
      exper2 |  -1.47e-06    .000021    -0.07   0.944    -.0000426    .0000397
             |
        year |
          2  |   .0237152   .0054554     4.35   0.000     .0130229    .0344076
          3  |   .0477464   .0096925     4.93   0.000     .0287494    .0667434
          4  |   .0665136   .0142041     4.68   0.000     .0386742    .0943531
          5  |   .0943116   .0188873     4.99   0.000     .0572932      .13133
          6  |   .1193361   .0239579     4.98   0.000     .0723795    .1662927
          7  |    .141157   .0291823     4.84   0.000     .0839607    .1983533
          8  |   .1669838   .0348128     4.80   0.000      .098752    .2352156
          9  |   .1891215   .0400232     4.73   0.000     .1106775    .2675656
         10  |    .214997    .045151     4.76   0.000     .1265027    .3034913
             |
       _cons |   7.018367   .0365398   192.07   0.000      6.94675    7.089984
-------------+----------------------------------------------------------------
     sigma_u |  .29847191
     sigma_e |    .063545
         rho |  .95663856   (fraction of variance due to u_i)
------------------------------------------------------------------------------
Instrumented:   educ
Instruments:    exper exper2 2.year 3.year 4.year 5.year 6.year 7.year 8.year
                9.year 10.year q1
------------------------------------------------------------------------------
r; t=0.16 15:12:02

.                         est store RE_IV
r; t=0.00 15:12:02

. 
.                 // DISCUSS the underlying problems with this exercise
. 
. 
. // # 4. HETEROSKEDASDICITY & SERIAL CORRELATION
. 
.         // # 4.1. test for heteroskedasticity within panel data
. 
.                 // optimal solution proposed by Greene, Econometric Analysis
. 
.                         xtreg lnwage educ exper exper2 i.year, fe
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9360                                         min =         10
     between = 0.5407                                         avg =       10.0
     overall = 0.5854                                         max =         10

                                                F(11,4444)        =    5911.96
corr(u_i, Xb)  = 0.1876                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0624152   .0009619    64.89   0.000     .0605295     .064301
       exper |   .0253104   .0008015    31.58   0.000     .0237391    .0268817
      exper2 |   3.55e-06   .0000195     0.18   0.855    -.0000346    .0000417
             |
        year |
          2  |   .0001748    .002753     0.06   0.949    -.0052224     .005572
          3  |   .0005613   .0026483     0.21   0.832    -.0046306    .0057533
          4  |  -.0043192   .0025799    -1.67   0.094    -.0093771    .0007388
          5  |  -.0002396   .0025466    -0.09   0.925    -.0052322     .004753
          6  |   .0008121   .0025459     0.32   0.750     -.004179    .0058033
          7  |  -.0014379   .0025792    -0.56   0.577    -.0064945    .0036187
          8  |   .0000387   .0026471     0.01   0.988    -.0051509    .0052283
          9  |  -.0018782   .0027525    -0.68   0.495    -.0072745    .0035181
         10  |          0  (omitted)
             |
       _cons |   6.793912   .0058888  1153.71   0.000     6.782367    6.805457
-------------+----------------------------------------------------------------
     sigma_u |  .30943273
     sigma_e |  .04554041
         rho |  .97879907   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 4444) = 270.45                 Prob > F = 0.0000
r; t=0.05 15:12:02

.                                 xttest3

Modified Wald test for groupwise heteroskedasticity
in fixed effect regression model

H0: sigma(i)^2 = sigma^2 for all i

chi2 (495)  =   1457.97
Prob>chi2 =      0.0000

r; t=0.02 15:12:02

. 
.         // # 4.2. test for serial correlation within panel data
.                 drop yy*
r; t=0.00 15:12:02

.                 tab year, gen(yy)

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        495       10.00       10.00
          2 |        495       10.00       20.00
          3 |        495       10.00       30.00
          4 |        495       10.00       40.00
          5 |        495       10.00       50.00
          6 |        495       10.00       60.00
          7 |        495       10.00       70.00
          8 |        495       10.00       80.00
          9 |        495       10.00       90.00
         10 |        495       10.00      100.00
------------+-----------------------------------
      Total |      4,950      100.00
r; t=0.00 15:12:02

.                         ret li

scalars:
                  r(N) =  4950
                  r(r) =  10
r; t=0.00 15:12:02

. 
.                 xtserial lnwage educ exper exper2 yy2-yy10

Wooldridge test for autocorrelation in panel data
H0: no first order autocorrelation
    F(  1,     494) =      0.321
           Prob > F =      0.5713
r; t=0.04 15:12:02

.                         
.                         xtreg lnwage educ exper exper2 i.year, fe cluster(workerid)
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9360                                         min =         10
     between = 0.5407                                         avg =       10.0
     overall = 0.5854                                         max =         10

                                                F(11,494)         =    5861.40
corr(u_i, Xb)  = 0.1876                         Prob > F          =     0.0000

                             (Std. Err. adjusted for 495 clusters in workerid)
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0624152   .0009714    64.25   0.000     .0605067    .0643238
       exper |   .0253104   .0008409    30.10   0.000     .0236582    .0269627
      exper2 |   3.55e-06   .0000201     0.18   0.860    -.0000359     .000043
             |
        year |
          2  |   .0001748   .0026802     0.07   0.948    -.0050912    .0054408
          3  |   .0005613   .0025138     0.22   0.823    -.0043776    .0055003
          4  |  -.0043192   .0025773    -1.68   0.094     -.009383    .0007447
          5  |  -.0002396   .0024609    -0.10   0.922    -.0050748    .0045956
          6  |   .0008121   .0026168     0.31   0.756    -.0043293    .0059535
          7  |  -.0014379   .0025184    -0.57   0.568    -.0063859    .0035101
          8  |   .0000387   .0026544     0.01   0.988    -.0051766    .0052539
          9  |  -.0018782   .0027192    -0.69   0.490    -.0072207    .0034644
         10  |          0  (omitted)
             |
       _cons |   6.793912   .0060606  1121.00   0.000     6.782004     6.80582
-------------+----------------------------------------------------------------
     sigma_u |  .30943273
     sigma_e |  .04554041
         rho |  .97879907   (fraction of variance due to u_i)
------------------------------------------------------------------------------
r; t=0.06 15:12:02

. 
.                 // following this sequence of tests you can also test for cross-sectional
.                 // correlation in fixed effects model
.                 
.                 xtdes

workerid:  1, 2, ..., 495                                    n =        495
    year:  1, 2, ..., 10                                     T =         10
           Delta(year) = 1 unit
           Span(year)  = 10 periods
           (workerid*year uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                        10      10      10        10        10      10      10

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+------------
      495    100.00  100.00 |  1111111111
 ---------------------------+------------
      495    100.00         |  XXXXXXXXXX
r; t=0.06 15:12:02

.                 
.                 
.                 // the following solution would issue an error message in the original data as there 
.                 // are too many cross-section units ==> build a small ramdom sample
. 
.                         preserve
r; t=0.01 15:12:02

.                                 set seed 234
r; t=0.00 15:12:02

.                                 sample2 1,cluster(workerid)
(4,900 observations deleted)
r; t=0.01 15:12:02

.                                 xtreg lnwage educ exper exper2 i.year, fe
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =         50
Group variable: workerid                        Number of groups  =          5

R-sq:                                           Obs per group:
     within  = 0.9451                                         min =         10
     between = 0.5468                                         avg =       10.0
     overall = 0.5781                                         max =         10

                                                F(11,34)          =      53.24
corr(u_i, Xb)  = 0.2369                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0668826   .0108819     6.15   0.000     .0447679    .0889973
       exper |   .0233737   .0062768     3.72   0.001     .0106178    .0361296
      exper2 |   .0001082   .0002086     0.52   0.607    -.0003158    .0005322
             |
        year |
          2  |  -.0140217   .0268438    -0.52   0.605    -.0685749    .0405316
          3  |   .0188509   .0258039     0.73   0.470    -.0335889    .0712908
          4  |  -.0059958    .025156    -0.24   0.813    -.0571188    .0451273
          5  |  -.0141968    .024924    -0.57   0.573    -.0648485    .0364548
          6  |   .0227263   .0248659     0.91   0.367    -.0278072    .0732598
          7  |   .0610228    .025166     2.42   0.021     .0098792    .1121664
          8  |  -.0071306    .025832    -0.28   0.784    -.0596277    .0453664
          9  |  -.0005197   .0268265    -0.02   0.985    -.0550377    .0539983
         10  |          0  (omitted)
             |
       _cons |   6.673761   .0484745   137.68   0.000     6.575249    6.772273
-------------+----------------------------------------------------------------
     sigma_u |  .36759376
     sigma_e |  .04460257
         rho |  .98549104   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(4, 34) = 34.24                      Prob > F = 0.0000
r; t=0.02 15:12:02

.                                         xttest2
 
Correlation matrix of residuals:

          __e24   __e129   __e225   __e379   __e469
 __e24   1.0000
__e129  -0.3910   1.0000
__e225  -0.3406   0.1368   1.0000
__e379   0.3274  -0.8722  -0.1197   1.0000
__e469  -0.7314   0.1399  -0.1644  -0.3517   1.0000

Breusch-Pagan LM test of independence: chi2(10) =    18.752, Pr = 0.0435
Based on 10 complete observations over panel units
r; t=0.08 15:12:02

.                         restore
r; t=0.00 15:12:02

. 
.                 // you can also apply specification tests for error-component models
.                 // this is only relevant in case the Hausman test does not reject the validity of the RE model
. 
.                         xtreg lnwage educ exper exper2 year, re

Random-effects GLS regression                   Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9357                                         min =         10
     between = 0.7200                                         avg =       10.0
     overall = 0.7156                                         max =         10

                                                Wald chi2(4)      =   63417.77
corr(u_i, X)   = 0 (assumed)                    Prob > chi2       =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0666159   .0009336    71.35   0.000      .064786    .0684458
       exper |   .0045128   .0019421     2.32   0.020     .0007064    .0083192
      exper2 |   4.78e-06   .0000194     0.25   0.806    -.0000332    .0000428
        year |   .0186864   .0019361     9.65   0.000     .0148916    .0224811
       _cons |   6.966413   .0201272   346.12   0.000     6.926965    7.005862
-------------+----------------------------------------------------------------
     sigma_u |  .23458958
     sigma_e |  .04552531
         rho |  .96370615   (fraction of variance due to u_i)
------------------------------------------------------------------------------
r; t=0.09 15:12:03

.                                 
.                                 xttest1

Tests for the error component model:

        lnwage[workerid,t] = Xb + u[workerid] + v[workerid,t]
           v[workerid,t] = lambda v[workerid,(t-1)] + e[workerid,t]

        Estimated results:
                         |       Var     sd = sqrt(Var)
                ---------+-----------------------------
                  lnwage |   .2268796       .4763188
                       e |   .0020726      .04552531
                       u |   .0550323      .23458958

        Tests:
           Random Effects, Two Sided:
           ALM(Var(u)=0)         =14934.23 Pr>chi2(1) =  0.0000

           Random Effects, One Sided:
           ALM(Var(u)=0)         =  122.21 Pr>N(0,1)  =  0.0000

           Serial Correlation:
           ALM(lambda=0)         =   76.67 Pr>chi2(1) =  0.0000

           Joint Test:
           LM(Var(u)=0,lambda=0) =19959.96 Pr>chi2(2) =  0.0000

r; t=0.04 15:12:03

. 
.                 // CONCLUSION: the above results lead us to conclude that we reject the base hypothesis
.                 // of the FE model that we have homoskedasticy & no serial correlation in the error term
. 
.                 // the cluster-robust standard errors allow for heteroscedasticity and serial correlation
.                 // correct solution would be
. 
. 
.         // # 4.3. SUGGESTED MODEL
. 
.                 xtreg lnwage educ exper exper2 i.year, fe cluster(workerid)
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9360                                         min =         10
     between = 0.5407                                         avg =       10.0
     overall = 0.5854                                         max =         10

                                                F(11,494)         =    5861.40
corr(u_i, Xb)  = 0.1876                         Prob > F          =     0.0000

                             (Std. Err. adjusted for 495 clusters in workerid)
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0624152   .0009714    64.25   0.000     .0605067    .0643238
       exper |   .0253104   .0008409    30.10   0.000     .0236582    .0269627
      exper2 |   3.55e-06   .0000201     0.18   0.860    -.0000359     .000043
             |
        year |
          2  |   .0001748   .0026802     0.07   0.948    -.0050912    .0054408
          3  |   .0005613   .0025138     0.22   0.823    -.0043776    .0055003
          4  |  -.0043192   .0025773    -1.68   0.094     -.009383    .0007447
          5  |  -.0002396   .0024609    -0.10   0.922    -.0050748    .0045956
          6  |   .0008121   .0026168     0.31   0.756    -.0043293    .0059535
          7  |  -.0014379   .0025184    -0.57   0.568    -.0063859    .0035101
          8  |   .0000387   .0026544     0.01   0.988    -.0051766    .0052539
          9  |  -.0018782   .0027192    -0.69   0.490    -.0072207    .0034644
         10  |          0  (omitted)
             |
       _cons |   6.793912   .0060606  1121.00   0.000     6.782004     6.80582
-------------+----------------------------------------------------------------
     sigma_u |  .30943273
     sigma_e |  .04554041
         rho |  .97879907   (fraction of variance due to u_i)
------------------------------------------------------------------------------
r; t=0.06 15:12:03

.                         est store FE_cluster
r; t=0.00 15:12:03

. 
.                                 test educ

 ( 1)  educ = 0

       F(  1,   494) = 4128.42
            Prob > F =    0.0000
r; t=0.00 15:12:03

.                                 test exper exper2

 ( 1)  exper = 0
 ( 2)  exper2 = 0

       F(  2,   494) =  966.14
            Prob > F =    0.0000
r; t=0.00 15:12:03

.                                 estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
  FE_cluster |      4,950   1729.642   8534.459      11  -17046.92  -16975.34
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] BIC note.
r; t=0.00 15:12:03

. 
. 
. // # 5. GOODNESS-OF-FIT measures
. 
.         egen meduc = mean(educ),by(workerid)
r; t=0.01 15:12:03

.         gen deduc = educ - meduc
r; t=0.00 15:12:03

.         egen mlnwage = mean(lnwage),by(workerid)
r; t=0.00 15:12:03

.         gen dlnwage = lnwage - mlnwage
r; t=0.00 15:12:03

. 
.                 xtreg lnwage educ, fe

Fixed-effects (within) regression               Number of obs     =      4,950
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9012                                         min =         10
     between = 0.7161                                         avg =       10.0
     overall = 0.7397                                         max =         10

                                                F(1,4454)         =   40605.51
corr(u_i, Xb)  = 0.0497                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1048446   .0005203   201.51   0.000     .1038246    .1058647
       _cons |   6.935271   .0028355  2445.84   0.000     6.929712     6.94083
-------------+----------------------------------------------------------------
     sigma_u |  .23752516
     sigma_e |  .05654834
         rho |  .94636139   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 4454) = 176.00                 Prob > F = 0.0000
r; t=0.03 15:12:03

.                 
.                 ereturn list

scalars:
               e(r2_w) =  .9011529310759636
                e(F_f) =  175.9967903036652
               e(rank) =  2
               e(Tbar) =  10
               e(Tcon) =  1
              e(g_min) =  10
              e(g_avg) =  10
              e(g_max) =  10
                e(N_g) =  495
            e(sigma_u) =  .2375251615469335
               e(corr) =  .0497156025927037
               e(r2_o) =  .739710894840365
               e(r2_b) =  .7160836570160244
            e(sigma_e) =  .0565483417424313
              e(sigma) =  .2441637100834513
                e(rho) =  .9463613897516259
                  e(p) =  0
                e(p_f) =  0
               e(df_m) =  495
               e(df_b) =  1
               e(ll_0) =  1729.642268372476
                 e(ll) =  7457.241187733353
                e(tss) =  1122.82717674668
               e(df_a) =  494
               e(r2_a) =  .8901674575426457
                e(rss) =  14.24262240430894
                e(mss) =  129.8448306617435
               e(rmse) =  .0565483417424313
                 e(r2) =  .9011529310759636
                  e(F) =  40605.50503623819
               e(df_r) =  4454
                  e(N) =  4950

macros:
            e(cmdline) : "xtreg lnwage educ, fe"
                e(cmd) : "xtreg"
       e(marginsnotok) : "E U UE SCore STDP XBU"
            e(predict) : "xtrefe_p"
              e(model) : "fe"
                e(vce) : "conventional"
               e(ivar) : "workerid"
             e(depvar) : "lnwage"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2

functions:
             e(sample)   
r; t=0.00 15:12:03

.                         display "RMSE:  " e(rmse)
RMSE:  .05654834
r; t=0.00 15:12:03

.                         
.                 estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      4,950   1729.642   7457.241       2  -14910.48  -14897.47
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] BIC note.
r; t=0.00 15:12:03

.                         
.                 // R sq, within
.                         reg dlnwage deduc

      Source |       SS           df       MS      Number of obs   =     4,950
-------------+----------------------------------   F(1, 4948)      =  45109.12
       Model |  129.844831         1  129.844831   Prob > F        =    0.0000
    Residual |  14.2426225     4,948   .00287846   R-squared       =    0.9012
-------------+----------------------------------   Adj R-squared   =    0.9011
       Total |  144.087453     4,949  .029114458   Root MSE        =    .05365

------------------------------------------------------------------------------
     dlnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       deduc |   .1048446   .0004936   212.39   0.000     .1038769    .1058124
       _cons |   1.94e-09   .0007626     0.00   1.000     -.001495     .001495
------------------------------------------------------------------------------
r; t=0.02 15:12:03

. 
.                 // R sq, between
.                         preserve
r; t=0.01 15:12:03

.                                 collapse (mean) lnwage educ,by(workerid)
r; t=0.01 15:12:03

.                                 reg lnwage educ

      Source |       SS           df       MS      Number of obs   =       495
-------------+----------------------------------   F(1, 493)       =   1243.43
       Model |   70.085952         1   70.085952   Prob > F        =    0.0000
    Residual |  27.7880204       493  .056365153   R-squared       =    0.7161
-------------+----------------------------------   Adj R-squared   =    0.7155
       Total |  97.8739724       494   .19812545   Root MSE        =    .23741

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1085713    .003079    35.26   0.000     .1025217    .1146208
       _cons |   6.915795   .0193083   358.18   0.000     6.877858    6.953732
------------------------------------------------------------------------------
r; t=0.01 15:12:03

.                         restore
r; t=0.00 15:12:03

. 
.                 // R sq, overall
.                         reg lnwage educ

      Source |       SS           df       MS      Number of obs   =     4,950
-------------+----------------------------------   F(1, 4948)      =  14061.63
       Model |  830.567496         1  830.567496   Prob > F        =    0.0000
    Residual |  292.259681     4,948  .059066225   R-squared       =    0.7397
-------------+----------------------------------   Adj R-squared   =    0.7397
       Total |  1122.82718     4,949  .226879607   Root MSE        =    .24304

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1079536   .0009104   118.58   0.000     .1061689    .1097383
       _cons |   6.919023   .0058796  1176.78   0.000     6.907496     6.93055
------------------------------------------------------------------------------
r; t=0.02 15:12:03

.                                 predict y_hat_ols
(option xb assumed; fitted values)
r; t=0.00 15:12:03

.                                         correlate lnwage y_hat_ols
(obs=4,950)

             |   lnwage y_hat_~s
-------------+------------------
      lnwage |   1.0000
   y_hat_ols |   0.8601   1.0000

r; t=0.00 15:12:03

.                                         ret li

scalars:
                  r(N) =  4950
                r(rho) =  .8600644713814024

matrices:
                  r(C) :  2 x 2
r; t=0.00 15:12:03

.                                         di r(rho)^2
.73971089
r; t=0.00 15:12:03

. 
.                         estimates restore FE
(results FE are active now)
r; t=0.00 15:12:03

.                                 predict y_hat_fe
(option xb assumed; fitted values)
r; t=0.00 15:12:03

.                                         correlate lnwage y_hat_fe
(obs=4,950)

             |   lnwage y_hat_fe
-------------+------------------
      lnwage |   1.0000
    y_hat_fe |   0.7651   1.0000

r; t=0.00 15:12:03

.                                         ret li

scalars:
                  r(N) =  4950
                r(rho) =  .7650840267871177

matrices:
                  r(C) :  2 x 2
r; t=0.00 15:12:03

.                                         di r(rho)^2
.58535357
r; t=0.00 15:12:03

. 
. 
. // # 6. OUTPUT EXPORT
. 
.                 estimates dir

-------------------------------------------------------------------
        name | command      depvar       npar  title 
-------------+-----------------------------------------------------
         OLS | regress      lnwage         14  Linear regression
          RE | xtreg        lnwage         14  
          FE | xtreg        lnwage         14  
          IV | ivreg2       lnwage          4  IV (2SLS) estimation
       FE_IV | xtivreg      lnwage         14  
       RE_IV | xtivreg      lnwage         14  
  FE_cluster | xtreg        lnwage         14  
-------------------------------------------------------------------
r; t=0.01 15:12:03

.                 est stats OLS RE FE IV FE_IV RE_IV FE_cluster

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
         OLS |      4,950   -3351.99   30.50728      13  -35.01455    49.5783
          RE |      4,950          .          .      13          .          .
          FE |      4,950   1729.642   8534.459      12  -17044.92  -16966.83
          IV |        495          .  -111.4332       4   230.8663   247.6846
       FE_IV |      4,950          .          .      11          .          .
       RE_IV |      4,950          .          .      13          .          .
  FE_cluster |      4,950   1729.642   8534.459      11  -17046.92  -16975.34
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] BIC note.
r; t=0.01 15:12:03

. 
.                         estimates table OLS RE FE IV FE_IV RE_IV FE_cluster, keep(educ exper exper2) ///
>                                 b(%7.4f) se(%7.4f) stats(N r2_a)

--------------------------------------------------------------------------------------------------
    Variable |    OLS         RE          FE          IV         FE_IV       RE_IV     FE_clus~r  
-------------+------------------------------------------------------------------------------------
        educ |    0.1072      0.0666      0.0624      0.0551   (omitted)      0.0563      0.0624  
             |    0.0010      0.0009      0.0010      0.0166                  0.0094      0.0010  
       exper |    0.0131      0.0045      0.0253      0.0150      0.0562      0.0045      0.0253  
             |    0.0022      0.0019      0.0008      0.0092      0.0009      0.0018      0.0008  
      exper2 |   -0.0003      0.0000      0.0000     -0.0006     -0.0000     -0.0000      0.0000  
             |    0.0001      0.0000      0.0000      0.0005      0.0000      0.0000      0.0000  
-------------+------------------------------------------------------------------------------------
           N |      4950        4950        4950         495        4950        4950        4950  
        r2_a |    0.7444                  0.9288      0.5158                              0.9359  
--------------------------------------------------------------------------------------------------
                                                                                      legend: b/se
r; t=0.13 15:12:03

. 
.                         estimates table OLS RE FE IV FE_IV RE_IV FE_cluster, keep(educ exper exper2) ///
>                                 b(%7.4f) star stats(N r2_a)

-----------------------------------------------------------------------------------------------------------------------
    Variable |     OLS             RE             FE             IV           FE_IV          RE_IV        FE_cluster   
-------------+---------------------------------------------------------------------------------------------------------
        educ |    0.1072***      0.0666***      0.0624***      0.0551***   (omitted)         0.0563***      0.0624***  
       exper |    0.0131***      0.0045*        0.0253***      0.0150         0.0562***      0.0045*        0.0253***  
      exper2 |   -0.0003***      0.0000         0.0000        -0.0006        -0.0000        -0.0000         0.0000     
-------------+---------------------------------------------------------------------------------------------------------
           N |      4950           4950           4950            495           4950           4950           4950     
        r2_a |    0.7444                        0.9288         0.5158                                       0.9359     
-----------------------------------------------------------------------------------------------------------------------
                                                                               legend: * p<0.05; ** p<0.01; *** p<0.001
r; t=0.05 15:12:03

.                         
.         outreg, clear
r; t=0.09 15:12:03

.                 
.                 estimates restore OLS
(results OLS are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag replace ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","OLS") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")

                                                                    -------------------------
                                                                                    OLS     
                                                                    -------------------------
                                                                     Education   0.1072***  
                                                                                  (0.0010)  
                                                                     Exper       0.0131***  
                                                                                  (0.0022)  
                                                                     Exper2      -0.0003*** 
                                                                                  (0.0001)  
                                                                     R2             0.75    
                                                                     RMSE           0.24    
                                                                     N             4,950    
                                                                    -------------------------
                                                                  * p<0.1; ** p<0.05; *** p<0.01

r; t=0.17 15:12:03

. 
.                 estimates restore RE
(results RE are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","RE") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 nodisplay summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")
r; t=0.01 15:12:03

. 
.                 estimates restore FE
(results FE are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","FE") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 nodisplay summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")
r; t=0.01 15:12:03

. 
.                 estimates restore IV
(results IV are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","IV") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 nodisplay summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")
r; t=0.01 15:12:03

. 
.                 estimates restore FE_IV
(results FE_IV are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(exper exper2) ///
>                                 ctitle("","FE_IV") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 nodisplay summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")
r; t=0.01 15:12:03

. 
.                 estimates restore RE_IV
(results RE_IV are active now)
r; t=0.00 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","RE_IV") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 nodisplay summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")
r; t=0.01 15:12:03

. 
.                 estimates restore FE_cluster
(results FE_cluster are active now)
r; t=0.01 15:12:03

.                         outreg using ../tex_paper/regression_analysis, tex frag merge ///
>                                 rtitles("Education" \ "" \ "Exper" \ "" \ "Exper2" \ "")  ///
>                                 keep(educ exper exper2) ///
>                                 ctitle("","FE_cluster") ///
>                                 bdec(4) se starlevels(10 5 1) starloc(1) ///
>                                 summstat(r2\rmse \ N) summtitle("R2"\"RMSE" \ "N")

                                   --------------------------------------------------------------------------------------------
                                                   OLS         RE         FE         IV        FE_IV      RE_IV    FE_cluster 
                                   --------------------------------------------------------------------------------------------
                                    Education   0.1072***   0.0666***  0.0624***  0.0551***             0.0563***  0.0624***  
                                                 (0.0010)   (0.0009)   (0.0010)   (0.0166)              (0.0094)    (0.0010)  
                                    Exper       0.0131***   0.0045**   0.0253***   0.0150    0.0562***  0.0045**   0.0253***  
                                                 (0.0022)   (0.0019)   (0.0008)   (0.0092)   (0.0009)   (0.0018)    (0.0008)  
                                    Exper2      -0.0003***   0.0000     0.0000     -0.0006    -0.0000    -0.0000     0.0000   
                                                 (0.0001)   (0.0000)   (0.0000)   (0.0005)   (0.0000)   (0.0000)    (0.0000)  
                                    R2             0.75         .        0.94       0.52         .          .         0.94    
                                    RMSE           0.24       0.05       0.05       0.30         .          .         0.04    
                                    N             4,950       4,950      4,950       495       4,950      4,950      4,950    
                                   --------------------------------------------------------------------------------------------
                                                                  * p<0.1; ** p<0.05; *** p<0.01

r; t=0.01 15:12:03

. 
. 
. // # 7. DYNAMIC PANEL DATA
. 
.         use ../data/data_simulation, clear
r; t=0.00 15:12:03

. 
.                 //tab year, ge(yy)
. 
.                 // # 7.1. estimate OLS & FE benchmark models
. 
.                                 reg lnwage l.lnwage educ exper exper2 yy3-yy10, cluster(workerid)

Linear regression                               Number of obs     =      4,455
                                                F(12, 494)        =   36845.43
                                                Prob > F          =     0.0000
                                                R-squared         =     0.9784
                                                Root MSE          =     .06953

                             (Std. Err. adjusted for 495 clusters in workerid)
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .9384303   .0038912   241.17   0.000     .9307849    .9460756
             |
        educ |   .0081704   .0004845    16.86   0.000     .0072184    .0091224
       exper |   .0010401   .0005134     2.03   0.043     .0000313    .0020488
      exper2 |  -.0000251   .0000173    -1.45   0.147     -.000059    8.81e-06
         yy3 |   .0002914   .0052031     0.06   0.955    -.0099315    .0105144
         yy4 |  -.0057902   .0040677    -1.42   0.155    -.0137823     .002202
         yy5 |   .0026828   .0045043     0.60   0.552    -.0061672    .0115327
         yy6 |   .0013488   .0042237     0.32   0.750    -.0069498    .0096474
         yy7 |  -.0019459    .004397    -0.44   0.658    -.0105851    .0066932
         yy8 |   .0031729   .0042301     0.75   0.454    -.0051383    .0114842
         yy9 |   -.003815   .0043427    -0.88   0.380    -.0123475    .0047175
        yy10 |  -.0014524   .0044039    -0.33   0.742    -.0101052    .0072003
       _cons |   .4614938   .0264509    17.45   0.000     .4095238    .5134639
------------------------------------------------------------------------------
r; t=0.02 15:12:03

.                                         est store ols
r; t=0.00 15:12:03

. 
.                                 xtreg lnwage l.lnwage educ exper exper2 yy3-yy10, fe cluster(workerid)
note: yy10 omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,455
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9248                                         min =          9
     between = 0.4418                                         avg =        9.0
     overall = 0.4925                                         max =          9

                                                F(11,494)         =    4096.62
corr(u_i, Xb)  = 0.1067                         Prob > F          =     0.0000

                             (Std. Err. adjusted for 495 clusters in workerid)
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |  -.0806473   .0135844    -5.94   0.000    -.1073377   -.0539569
             |
        educ |    .066634   .0012714    52.41   0.000     .0641359    .0691321
       exper |   .0283148   .0010906    25.96   0.000      .026172    .0304576
      exper2 |   -.000018   .0000246    -0.73   0.466    -.0000664    .0000304
         yy3 |   .0002169   .0026681     0.08   0.935    -.0050254    .0054591
         yy4 |  -.0046908   .0025836    -1.82   0.070    -.0097671    .0003854
         yy5 |   -.001067   .0025536    -0.42   0.676    -.0060843    .0039504
         yy6 |   .0001772   .0026052     0.07   0.946    -.0049415    .0052959
         yy7 |  -.0019412   .0025281    -0.77   0.443    -.0069085     .003026
         yy8 |  -.0006686   .0026647    -0.25   0.802    -.0059041    .0045669
         yy9 |  -.0020146   .0026124    -0.77   0.441    -.0071474    .0031181
        yy10 |          0  (omitted)
       _cons |   7.333542   .0915157    80.13   0.000     7.153734     7.51335
-------------+----------------------------------------------------------------
     sigma_u |  .33627433
     sigma_e |  .04549442
         rho |  .98202571   (fraction of variance due to u_i)
------------------------------------------------------------------------------
r; t=0.06 15:12:03

.                                         est store fe
r; t=0.00 15:12:03

. 
.                 // # 7.2. GMM first-differences estimation, Arellano & Bond (1991)
. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy3-yy10, gmm(lnwage, lag(2 5)) gmm(educ, lag(2 5)) iv(i.year) ar(2) small noleveleq
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy10 dropped due to collinearity

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      3960
Time variable : year                            Number of groups   =       495
Number of instruments = 60                      Obs per group: min =         8
F(11, 3949)   =   4006.29                                      avg =      8.00
Prob > F      =     0.000                                      max =         8
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .0075954   .0272902     0.28   0.781    -.0459088    .0610996
             |
        educ |   .0744596   .0102419     7.27   0.000     .0543797    .0945394
       exper |    .013557   .0078891     1.72   0.086    -.0019102    .0290242
      exper2 |   .0001874   .0001789     1.05   0.295    -.0001634    .0005382
         yy3 |   .0022102   .0030911     0.72   0.475    -.0038501    .0082704
         yy4 |  -.0012098   .0035898    -0.34   0.736    -.0082478    .0058282
         yy5 |   .0038841   .0040394     0.96   0.336    -.0040353    .0118036
         yy6 |   .0050309   .0041167     1.22   0.222    -.0030401    .0131019
         yy7 |   .0023396   .0039194     0.60   0.551    -.0053445    .0100238
         yy8 |   .0024975   .0034518     0.72   0.469      -.00427     .009265
         yy9 |  -.0005556   .0030359    -0.18   0.855    -.0065077    .0053966
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(1b.year 2.year 3.year 4.year 5.year 6.year 7.year 8.year 9.year
    10.year)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(2/5).educ
    L(2/5).lnwage
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -28.34  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =  -1.47  Pr > z =  0.143
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(49)   =  47.82  Prob > chi2 =  0.521
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  gmm(lnwage, lag(2 5))
    Sargan test excluding group:     chi2(23)   =  18.96  Prob > chi2 =  0.704
    Difference (null H = exogenous): chi2(26)   =  28.87  Prob > chi2 =  0.317
  gmm(educ, lag(2 5))
    Sargan test excluding group:     chi2(23)   =  31.24  Prob > chi2 =  0.117
    Difference (null H = exogenous): chi2(26)   =  16.58  Prob > chi2 =  0.921
  iv(1b.year 2.year 3.year 4.year 5.year 6.year 7.year 8.year 9.year 10.year)
    Sargan test excluding group:     chi2(41)   =  43.81  Prob > chi2 =  0.353
    Difference (null H = exogenous): chi2(8)    =   4.01  Prob > chi2 =  0.856

r; t=1.74 15:12:05

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy3-yy10, gmm(lnwage, lag(2 5)) gmm(educ, lag(2 5)) iv(yy3-yy9) ar(2) small noleveleq
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy10 dropped due to collinearity

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      3960
Time variable : year                            Number of groups   =       495
Number of instruments = 59                      Obs per group: min =         8
F(11, 3949)   =   3903.47                                      avg =      8.00
Prob > F      =     0.000                                      max =         8
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .0053083   .0276971     0.19   0.848    -.0489937    .0596102
             |
        educ |    .081014   .0116912     6.93   0.000     .0580926    .1039354
       exper |  -.0049746   .0172257    -0.29   0.773    -.0387468    .0287975
      exper2 |   .0007077   .0004652     1.52   0.128    -.0002044    .0016198
         yy3 |   .0061155   .0044878     1.36   0.173    -.0026831    .0149142
         yy4 |   .0055703   .0066626     0.84   0.403    -.0074921    .0186328
         yy5 |   .0124215    .008134     1.53   0.127    -.0035257    .0283688
         yy6 |   .0140462   .0085146     1.65   0.099    -.0026472    .0307395
         yy7 |   .0106969   .0079448     1.35   0.178    -.0048793    .0262732
         yy8 |   .0088634   .0063008     1.41   0.160    -.0034898    .0212166
         yy9 |   .0031192   .0043138     0.72   0.470    -.0053382    .0115767
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(yy3 yy4 yy5 yy6 yy7 yy8 yy9)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(2/5).educ
    L(2/5).lnwage
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -23.45  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =  -0.50  Pr > z =  0.616
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(48)   =  45.17  Prob > chi2 =  0.590
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  gmm(lnwage, lag(2 5))
    Sargan test excluding group:     chi2(22)   =  18.16  Prob > chi2 =  0.696
    Difference (null H = exogenous): chi2(26)   =  27.01  Prob > chi2 =  0.409
  gmm(educ, lag(2 5))
    Sargan test excluding group:     chi2(22)   =  28.75  Prob > chi2 =  0.152
    Difference (null H = exogenous): chi2(26)   =  16.42  Prob > chi2 =  0.926
  iv(yy3 yy4 yy5 yy6 yy7 yy8 yy9)
    Sargan test excluding group:     chi2(41)   =  42.73  Prob > chi2 =  0.397
    Difference (null H = exogenous): chi2(7)    =   2.43  Prob > chi2 =  0.932

r; t=0.81 15:12:06

.                                         est store fd
r; t=0.00 15:12:06

. 
. 
.                 // # 7.3. GMM system estimation, Arellano & Bover (1995), Blundell & Bond (1998)
. 
.                         // automatically insert timme dummies
.                                 xtabond2 lnwage l.lnwage educ exper exper2 i.year, gmm(lnwage, lag(2 .))
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.

Dynamic panel-data estimation, one-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 45                      Obs per group: min =         9
Wald chi2(14) =  56585.64                                      avg =      9.00
Prob > chi2   =     0.000                                      max =         9
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .0941112   .0263484     3.57   0.000     .0424693    .1457532
             |
        educ |   .0637226   .0022045    28.91   0.000     .0594019    .0680433
       exper |   .0085945   .0120354     0.71   0.475    -.0149944    .0321834
      exper2 |  -.0005544    .000383    -1.45   0.148    -.0013051    .0001963
             |
        year |
          1  |          0  (empty)
          2  |  -.2195014   .0172083   -12.76   0.000     -.253229   -.1857738
          3  |  -.1953004   .0148221   -13.18   0.000    -.2243511   -.1662497
          4  |  -.1752268   .0129456   -13.54   0.000    -.2005996   -.1498539
          5  |  -.1446442   .0114084   -12.68   0.000    -.1670042   -.1222842
          6  |  -.1170751   .0098778   -11.85   0.000    -.1364352    -.097715
          7  |  -.0913198   .0082355   -11.09   0.000    -.1074611   -.0751786
          8  |  -.0609329   .0063815    -9.55   0.000    -.0734405   -.0484254
          9  |  -.0333321   .0043214    -7.71   0.000    -.0418019   -.0248624
         10  |          0  (omitted)
             |
       _cons |   6.592959   .2102951    31.35   0.000     6.180788     7.00513
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(2/9).lnwage
Instruments for levels equation
  Standard
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL.lnwage
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -21.09  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   0.66  Pr > z =  0.509
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(30)   = 317.55  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Sargan test excluding group:     chi2(22)   =  35.96  Prob > chi2 =  0.031
    Difference (null H = exogenous): chi2(8)    = 281.60  Prob > chi2 =  0.000

r; t=0.69 15:12:07

. 
.                         // manually insert timme dummies (created above with the command 'tab year, ge(yy)')
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, gmm(lnwage, lag(2 5)) gmm(educ exper exper2, lag(2 5) collapse) iv(yy2-yy10
> , eq(level)) ar(2) twostep robust small
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy9 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate optimal weighting matrix for two-step estimation.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, two-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 57                      Obs per group: min =         9
F(12, 494)    =   3861.08                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |              Corrected
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |    .005946   .0287456     0.21   0.836    -.0505327    .0624247
             |
        educ |   .0697447   .0050534    13.80   0.000     .0598158    .0796736
       exper |   .0067337   .0021276     3.16   0.002     .0025535    .0109139
      exper2 |  -.0000393   .0000261    -1.50   0.133    -.0000907     .000012
         yy2 |  -.1101459   .0222376    -4.95   0.000    -.1538378    -.066454
         yy3 |  -.0926245   .0194286    -4.77   0.000    -.1307973   -.0544516
         yy4 |  -.0813599   .0165165    -4.93   0.000    -.1138111   -.0489087
         yy5 |  -.0620778   .0134009    -4.63   0.000    -.0884075   -.0357481
         yy6 |  -.0452758   .0101739    -4.45   0.000    -.0652653   -.0252864
         yy7 |  -.0313776   .0073296    -4.28   0.000    -.0457787   -.0169766
         yy8 |  -.0130148   .0044409    -2.93   0.004    -.0217403   -.0042894
        yy10 |   .0183427   .0042833     4.28   0.000      .009927    .0267584
       _cons |   7.039115   .2101746    33.49   0.000     6.626169    7.452062
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(2/5).(educ exper exper2) collapsed
    L(2/5).lnwage
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL.(educ exper exper2) collapsed
    DL.lnwage
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -15.41  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =  -1.41  Pr > z =  0.159
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(44)   = 310.37  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(44)   =  35.33  Prob > chi2 =  0.822
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(34)   =  31.91  Prob > chi2 =  0.571
    Difference (null H = exogenous): chi2(10)   =   3.42  Prob > chi2 =  0.970
  gmm(lnwage, lag(2 5))
    Hansen test excluding group:     chi2(10)   =   2.18  Prob > chi2 =  0.995
    Difference (null H = exogenous): chi2(34)   =  33.15  Prob > chi2 =  0.509
  gmm(educ exper exper2, collapse lag(2 5))
    Hansen test excluding group:     chi2(30)   =  31.89  Prob > chi2 =  0.373
    Difference (null H = exogenous): chi2(14)   =   3.44  Prob > chi2 =  0.998
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(36)   =  34.51  Prob > chi2 =  0.540
    Difference (null H = exogenous): chi2(8)    =   0.82  Prob > chi2 =  0.999

r; t=1.34 15:12:08

.                                         est store sys
r; t=0.00 15:12:08

. 
.                         xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, gmm(lnwage, lag(3 5) collapse) gmm(educ exper exper2, lag(3 5) collapse) iv(yy2-yy1
> 0, eq(level)) ar(2) robust small
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy9 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate robust weighting matrix for Hansen test.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, one-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 24                      Obs per group: min =         9
F(12, 494)    =   3381.66                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   -.006429   .3375635    -0.02   0.985    -.6696663    .6568083
             |
        educ |   .0740368   .0240931     3.07   0.002     .0266992    .1213744
       exper |   .0056594   .0030672     1.85   0.066    -.0003668    .0116857
      exper2 |  -.0000269   .0000355    -0.76   0.450    -.0000967    .0000429
         yy2 |  -.1045758   .0475856    -2.20   0.028    -.1980709   -.0110807
         yy3 |  -.0886872   .0408969    -2.17   0.031    -.1690404   -.0083339
         yy4 |  -.0779841   .0340322    -2.29   0.022    -.1448498   -.0111184
         yy5 |  -.0584092   .0285183    -2.05   0.041    -.1144413   -.0023771
         yy6 |  -.0422017   .0212749    -1.98   0.048    -.0840022   -.0004012
         yy7 |  -.0294053   .0141522    -2.08   0.038    -.0572111   -.0015994
         yy8 |  -.0133463   .0088626    -1.51   0.133    -.0307594    .0040668
        yy10 |   .0172878   .0072828     2.37   0.018     .0029787    .0315968
       _cons |   7.121314   2.381455     2.99   0.003     2.442284    11.80034
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(3/5).(educ exper exper2) collapsed
    L(3/5).lnwage collapsed
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL2.(educ exper exper2) collapsed
    DL2.lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z =  -1.50  Pr > z =  0.133
Arellano-Bond test for AR(2) in first differences: z =  -0.22  Pr > z =  0.824
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(11)   =  11.08  Prob > chi2 =  0.437
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(11)   =   3.22  Prob > chi2 =  0.987
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(8)    =   1.71  Prob > chi2 =  0.989
    Difference (null H = exogenous): chi2(3)    =   1.51  Prob > chi2 =  0.681
  gmm(lnwage, collapse lag(3 5))
    Hansen test excluding group:     chi2(7)    =   1.28  Prob > chi2 =  0.989
    Difference (null H = exogenous): chi2(4)    =   1.94  Prob > chi2 =  0.746
  gmm(educ exper exper2, collapse lag(3 5))
    Hansen test excluding group:     chi2(0)    =   0.00  Prob > chi2 =      .
    Difference (null H = exogenous): chi2(11)   =   3.22  Prob > chi2 =  0.987
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(3)    =   0.65  Prob > chi2 =  0.885
    Difference (null H = exogenous): chi2(8)    =   2.57  Prob > chi2 =  0.958

r; t=0.52 15:12:08

.                         xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, gmm(lnwage, lag(3 5) collapse) gmm(educ exper exper2, lag(3 5) collapse) iv(yy2-yy1
> 0, eq(level)) ar(2) robust small twostep
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy9 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate optimal weighting matrix for two-step estimation.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, two-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 24                      Obs per group: min =         9
F(12, 494)    =   3445.59                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |              Corrected
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .0344072   .3665819     0.09   0.925    -.6858448    .7546591
             |
        educ |   .0730915   .0269906     2.71   0.007     .0200609    .1261221
       exper |   .0054498   .0031912     1.71   0.088    -.0008203    .0117198
      exper2 |  -.0000288   .0000375    -0.77   0.442    -.0001025    .0000448
         yy2 |  -.0939013   .0464722    -2.02   0.044    -.1852088   -.0025938
         yy3 |  -.0794096    .040143    -1.98   0.048    -.1582816   -.0005375
         yy4 |    -.07044   .0330732    -2.13   0.034    -.1354215   -.0054585
         yy5 |  -.0522578   .0279092    -1.87   0.062    -.1070933    .0025777
         yy6 |  -.0373546   .0207589    -1.80   0.073    -.0781413     .003432
         yy7 |  -.0263545   .0138665    -1.90   0.058    -.0535991      .00089
         yy8 |  -.0114147    .008867    -1.29   0.199    -.0288365    .0060071
        yy10 |   .0158177   .0071184     2.22   0.027     .0018315    .0298038
       _cons |   6.820077   2.578299     2.65   0.008     1.754292    11.88586
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(3/5).(educ exper exper2) collapsed
    L(3/5).lnwage collapsed
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL2.(educ exper exper2) collapsed
    DL2.lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z =  -1.46  Pr > z =  0.143
Arellano-Bond test for AR(2) in first differences: z =  -0.09  Pr > z =  0.926
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(11)   =  11.08  Prob > chi2 =  0.437
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(11)   =   3.22  Prob > chi2 =  0.987
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(8)    =   1.71  Prob > chi2 =  0.989
    Difference (null H = exogenous): chi2(3)    =   1.51  Prob > chi2 =  0.681
  gmm(lnwage, collapse lag(3 5))
    Hansen test excluding group:     chi2(7)    =   1.28  Prob > chi2 =  0.989
    Difference (null H = exogenous): chi2(4)    =   1.94  Prob > chi2 =  0.746
  gmm(educ exper exper2, collapse lag(3 5))
    Hansen test excluding group:     chi2(0)    =   0.00  Prob > chi2 =      .
    Difference (null H = exogenous): chi2(11)   =   3.22  Prob > chi2 =  0.987
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(3)    =   0.65  Prob > chi2 =  0.885
    Difference (null H = exogenous): chi2(8)    =   2.57  Prob > chi2 =  0.958

r; t=0.61 15:12:09

. 
.                         // see the comments for the FD model on the rejection of the statistics
. 
.                                 est table ols fe fd sys, star(.1 .05 .02) drop(yy* _cons) stats(r2 ll sargan sarganp hansen hansenp) b(%5.4f) title(Dynamic Grow
> th regressions) /*
>                                         */ stfmt(%6.5f)

Dynamic Growth regressions

------------------------------------------------------------------
    Variable |    ols           fe           fd          sys      
-------------+----------------------------------------------------
      lnwage |
         L1. |  0.9384***   -0.0806***    0.0053       0.0059     
             |
        educ |  0.0082***    0.0666***    0.0810***    0.0697***  
       exper |  0.0010**     0.0283***   -0.0050       0.0067***  
      exper2 | -0.0000      -0.0000       0.0007      -0.0000     
-------------+----------------------------------------------------
          r2 | 0.97843      0.92478                               
          ll | 5.6e+03      7.7e+03                               
      sargan |                           45.16644      3.1e+02     
     sarganp |                           0.58965      0.00000     
      hansen |                                        35.32529     
     hansenp |                                        0.82154     
------------------------------------------------------------------
                               legend: * p<.1; ** p<.05; *** p<.02
r; t=0.04 15:12:09

. 
.                                         outreg2 [ols fe fd sys] using dynamic_results, bdec(4) sdec(4) /*
>                                                 */addstat(Hansen, e(hansen), Hansen p-value, e(hansenp)) word /*
>                                                 */ replace keep(l.lnwage educ) /*
>                                                 */ sortvar(l.lnwage education)
dynamic_results.rtf
dir : seeout
r; t=0.26 15:12:09

. 
. 
.                                 sh start dynamic_results.rtf    // execute a DOS command == !start
r; t=1.34 15:12:11

. 
.                 // 7.4. UNIT ROOT TESTS
.                 
.                         // define a balanced panel
.                         
.                                 egen nobs = count(workerid),by(workerid)
r; t=0.00 15:12:11

.                                         tab nobs

       nobs |      Freq.     Percent        Cum.
------------+-----------------------------------
         10 |      4,950      100.00      100.00
------------+-----------------------------------
      Total |      4,950      100.00
r; t=0.00 15:12:11

.                                         
.                                                 keep if nobs == 10
(0 observations deleted)
r; t=0.00 15:12:11

.                                                         drop nobs
r; t=0.00 15:12:11

. 
.                 // # 7.4.1. LLC test, using the AIC to choose the number of lags for regressions and using an HAC variance
.                 // estimator based on the Bartlett kernel and the number of lags chosen using Newey and West's method
.                         
.                         xtunitroot llc lnwage, demean lags(aic 2) kernel(bartlett nwest)
r(198); t=28.01 15:12:39

end of do-file

r(198); t=42.10 15:12:39

. do "C:\tmp\STD330c_000000.tmp"

.                 use ../data/data_simulation, clear
r; t=0.00 15:13:10

.                         //tab year, ge(yy)
.                                 set seed 234
r; t=0.00 15:13:10

. 
.                         drop lnwage
r; t=0.00 15:13:10

.                         bysort workerid (year): gen lnwage = ln(600) + ui + uniform()/ln(600) if _n == 1
(4,455 missing values generated)
r; t=0.00 15:13:10

.                                 bysort workerid (year): replace lnwage = ln(600) + 0.7*l.lnwage + ///
>                                         0.06*educ + 0.007*exper - 0.00001*exper2 + ///
>                                         0.02*year + ui + uniform()/ln(600) if _n > 1
(4,455 real changes made)
r; t=0.00 15:13:10

. 
.                                 
.                                 reg lnwage l.lnwage educ exper exper2 yy2-yy10
note: yy10 omitted because of collinearity

      Source |       SS           df       MS      Number of obs   =     4,455
-------------+----------------------------------   F(12, 4442)     >  99999.00
       Model |   77120.903        12  6426.74192   Prob > F        =    0.0000
    Residual |  79.3678256     4,442  .017867588   R-squared       =    0.9990
-------------+----------------------------------   Adj R-squared   =    0.9990
       Total |  77200.2709     4,454  17.3327954   Root MSE        =    .13367

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .9836796   .0028555   344.49   0.000     .9780815    .9892777
             |
        educ |   .0375438   .0008915    42.11   0.000     .0357961    .0392916
       exper |   .0083833   .0014262     5.88   0.000     .0055871    .0111794
      exper2 |  -.0002106   .0000477    -4.41   0.000    -.0003041   -.0001171
         yy2 |   4.606356   .0471831    97.63   0.000     4.513854    4.698859
         yy3 |    3.16024   .0330365    95.66   0.000     3.095472    3.225008
         yy4 |   2.151997   .0233522    92.15   0.000     2.106215    2.197779
         yy5 |   1.434819    .016872    85.04   0.000     1.401742    1.467897
         yy6 |   .9316663   .0127699    72.96   0.000      .906631    .9567015
         yy7 |   .5727817   .0103717    55.23   0.000      .552448    .5931154
         yy8 |   .3167439    .009148    34.62   0.000     .2988092    .3346787
         yy9 |   .1367309   .0086243    15.85   0.000     .1198229    .1536388
        yy10 |          0  (omitted)
       _cons |   .5163044   .0644233     8.01   0.000     .3900026    .6426062
------------------------------------------------------------------------------
r; t=0.01 15:13:10

.                                         est store ols_dd
r; t=0.00 15:13:10

. 
.                                 xtreg lnwage l.lnwage educ exper exper2 yy2-yy10, fe
note: yy9 omitted because of collinearity
note: yy10 omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,455
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9999                                         min =          9
     between = 0.9641                                         avg =        9.0
     overall = 0.9942                                         max =          9

                                                F(11,3949)        =   3.13e+06
corr(u_i, Xb)  = 0.1616                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .6948116   .0018414   377.32   0.000     .6912014    .6984218
             |
        educ |   .0614813   .0010956    56.12   0.000     .0593333    .0636294
       exper |   .0277517   .0031964     8.68   0.000      .021485    .0340184
      exper2 |  -.0000237   .0000228    -1.04   0.300    -.0000684    .0000211
         yy2 |  -.0803705   .0316446    -2.54   0.011    -.1424119   -.0183291
         yy3 |  -.0581077     .02381    -2.44   0.015    -.1047887   -.0114266
         yy4 |  -.0347071   .0182881    -1.90   0.058    -.0705622     .001148
         yy5 |  -.0237648   .0141219    -1.68   0.092    -.0514517    .0039222
         yy6 |  -.0140279   .0107125    -1.31   0.190    -.0350304    .0069746
         yy7 |  -.0090185   .0077131    -1.17   0.242    -.0241405    .0061035
         yy8 |  -.0067363   .0050081    -1.35   0.179    -.0165549    .0030824
         yy9 |          0  (omitted)
        yy10 |          0  (omitted)
       _cons |      6.892   .0587294   117.35   0.000     6.776857    7.007143
-------------+----------------------------------------------------------------
     sigma_u |  .31784188
     sigma_e |  .04539399
         rho |  .98001035   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 3949) = 74.39                  Prob > F = 0.0000
r; t=0.06 15:13:10

.                                         est store fe_dd
r; t=0.00 15:13:10

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy3-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy3-yy10) ar(2) noleveleq
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      3960
Time variable : year                            Number of groups   =       495
Number of instruments = 24                      Obs per group: min =         8
Wald chi2(11) =  3.33e+07                                      avg =      8.00
Prob > chi2   =     0.000                                      max =         8
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .7005175   .0042826   163.57   0.000     .6921238    .7089111
             |
        educ |   .0516894   .0259735     1.99   0.047     .0007824    .1025965
       exper |   .0301968   .0063899     4.73   0.000     .0176729    .0427208
      exper2 |  -.0000425   .0000269    -1.58   0.114    -.0000952    .0000102
         yy3 |  -.0050758   .0121533    -0.42   0.676     -.028896    .0187443
         yy4 |  -.0003674   .0174347    -0.02   0.983    -.0345389     .033804
         yy5 |  -.0019996   .0180997    -0.11   0.912    -.0374744    .0334752
         yy6 |   -.000185   .0147282    -0.01   0.990    -.0290518    .0286817
         yy7 |   8.97e-06   .0089651     0.00   0.999    -.0175623    .0175802
         yy9 |   .0054254   .0090514     0.60   0.549    -.0123151    .0231659
        yy10 |   .0050307    .017783     0.28   0.777    -.0298234    .0398848
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -25.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.39  Pr > z =  0.166
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(13)   =  12.86  Prob > chi2 =  0.458
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  gmm(lnwage, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  11.69  Prob > chi2 =  0.232
    Difference (null H = exogenous): chi2(4)    =   1.18  Prob > chi2 =  0.882
  gmm(educ, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  10.66  Prob > chi2 =  0.300
    Difference (null H = exogenous): chi2(4)    =   2.20  Prob > chi2 =  0.699
  gmm(exper exper2, collapse lag(0 5))
    Sargan test excluding group:     chi2(4)    =   4.14  Prob > chi2 =  0.387
    Difference (null H = exogenous): chi2(9)    =   8.72  Prob > chi2 =  0.464
  iv(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
    Sargan test excluding group:     chi2(6)    =   6.38  Prob > chi2 =  0.382
    Difference (null H = exogenous): chi2(7)    =   6.48  Prob > chi2 =  0.485

r; t=0.57 15:13:11

.                                                 est store fd_dd
r; t=0.00 15:13:11

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy2-yy10, eq(level)) ar(2) robust small
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate robust weighting matrix for Hansen test.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, one-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 28                      Obs per group: min =         9
F(12, 494)    = 470976.61                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |    .734721   .0067293   109.18   0.000     .7214994    .7479427
             |
        educ |   .1276313   .0028706    44.46   0.000     .1219912    .1332714
       exper |   .0068942   .0023591     2.92   0.004     .0022592    .0115293
      exper2 |  -.0000441   .0000672    -0.66   0.512    -.0001761    .0000879
         yy2 |   .6222577   .1051077     5.92   0.000     .4157445    .8287709
         yy3 |   .4287794   .0706237     6.07   0.000     .2900195    .5675394
         yy4 |   .2968444   .0463087     6.41   0.000     .2058581    .3878308
         yy5 |   .1936889    .028958     6.69   0.000      .136793    .2505849
         yy6 |   .1162911   .0165353     7.03   0.000      .083803    .1487793
         yy7 |   .0537439   .0076796     7.00   0.000     .0386552    .0688327
         yy9 |  -.0359565   .0063771    -5.64   0.000     -.048486    -.023427
        yy10 |  -.0709887     .01032    -6.88   0.000    -.0912652   -.0507122
       _cons |   5.904665   .1503296    39.28   0.000     5.609301    6.200029
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL.(exper exper2) collapsed
    DL.educ collapsed
    DL.lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -15.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.65  Pr > z =  0.100
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(15)   =4236.57  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(15)   = 144.27  Prob > chi2 =  0.000
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(11)   =   8.35  Prob > chi2 =  0.681
    Difference (null H = exogenous): chi2(4)    = 135.92  Prob > chi2 =  0.000
  gmm(lnwage, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   6.89  Prob > chi2 =  0.735
    Difference (null H = exogenous): chi2(5)    = 137.38  Prob > chi2 =  0.000
  gmm(educ, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   9.15  Prob > chi2 =  0.518
    Difference (null H = exogenous): chi2(5)    = 135.12  Prob > chi2 =  0.000
  gmm(exper exper2, collapse lag(0 5))
    Hansen test excluding group:     chi2(4)    =   5.69  Prob > chi2 =  0.224
    Difference (null H = exogenous): chi2(11)   = 138.58  Prob > chi2 =  0.000
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(8)    =  17.24  Prob > chi2 =  0.028
    Difference (null H = exogenous): chi2(7)    = 127.02  Prob > chi2 =  0.000

r; t=0.93 15:13:12

.                                                 est store sys_dd
r; t=0.00 15:13:12

. 
.                                 est table ols_dd fe_dd fd_dd sys_dd, star(.1 .05 .02) drop(yy* _cons) ///
>                                         stats(r2 ll sargan sarganp hansen hansenp) b(%5.4f) title(Dynamic Growth regressions)

Dynamic Growth regressions

------------------------------------------------------------------
    Variable |   ols_dd       fe_dd        fd_dd        sys_dd    
-------------+----------------------------------------------------
      lnwage |
         L1. |  0.9837***    0.6948***    0.7005***    0.7347***  
             |
        educ |  0.0375***    0.0615***    0.0517**     0.1276***  
       exper |  0.0084***    0.0278***    0.0302***    0.0069***  
      exper2 | -0.0002***   -0.0000      -0.0000      -0.0000     
-------------+----------------------------------------------------
          r2 |  0.9990       0.9999                               
          ll | 2.7e+03      7.7e+03                               
      sargan |                           12.8629      4.2e+03     
     sarganp |                            0.4585       0.0000     
      hansen |                                        144.2691     
     hansenp |                                         0.0000     
------------------------------------------------------------------
                               legend: * p<.1; ** p<.05; *** p<.02
r; t=0.06 15:13:12

. 
. 
.                 esttab ols_dd fe_dd fd_dd sys_dd using ../tex_paper/estimation_gmm_analysis.tex, replace ///
>                         keep(educ exper exper2) ///
>                         mtitle("OLS" "FE" "GMM-FD" "GMM-Sys") nonumbers ///
>                         coeflabel (educ Education exper "Experience" exper2 "Experience sq.") ///
>                         b(%5.4f) se(%5.4f) star(* 0.1 ** 0.05 *** 0.01) ///
>                                 scalars("N Observations" "N_g Workers" ///
>                                 "r2 \$R^{2}\$" "rmse Root MSE" ///
>                                 "ar1 AR(1)" "ar1p p-value" "ar2 AR(2)" "ar2p p-value" ///
>                                 "hansen Hansen" "hansen_df df" "hansenp H p-value") ///
>                         nonotes addnotes("Notes: standard errors in parenthesis. Significance levels: *, 10\%;" "**, 5\%; ***, 1\%. The dependent variable is ln
>  real GDP per workers." "Source: own computations.")
(output written to ../tex_paper/estimation_gmm_analysis.tex)
r; t=0.11 15:13:12

. 
. // # 8. High-Dimensional Fixed-Effects
. 
. clear
r; t=0.00 15:13:12

. 
. // # 8.1. build simulated data
. 
.         set obs 10000                   //      define the number of observations
number of observations (_N) was 0, now 10,000
r; t=0.00 15:13:12

.         set seed 345567789              //      define the 'seed' in order to be able
r; t=0.00 15:13:12

.                                                         //      to replicate the results
. 
.         // # 8.1.1 define worker's id and year of observation
.                 
.                 gen workerid = int(_n/10.1)+1
r; t=0.00 15:13:12

.                 bysort workerid: gen year = _n
r; t=0.00 15:13:12

. 
.         // # 8.1.2 define firms's id
.         
.                 gen firmid = int(_n/100.1)+1
r; t=0.00 15:13:12

. 
.                 sort workerid year
r; t=0.00 15:13:12

.                 tsset workerid year
       panel variable:  workerid (unbalanced)
        time variable:  year, 1 to 11
                delta:  1 unit
r; t=0.01 15:13:12

. 
.         // # 8.1.3 generate individual's specific effect, ui
.                 bysort workerid (year): gen double ui = runiform() if _n == 1
(9,009 missing values generated)
r; t=0.00 15:13:12

.                          bysort workerid (year): replace ui = ui[_n-1] if _n > 1
(9009 real changes made)
r; t=0.00 15:13:12

. 
.         // # 8.1.4 generate individual's specific effect, ui
.                 
.                 // bysort firmid (year): gen double fi = runiform() if _n == 1
.                 // bysort firmid (year): replace fi = fi[_n-1] if _n > 1
. 
.                          egen mean_ui = mean(ui),by(firmid)
r; t=0.00 15:13:12

. 
.                                 gen fi = mean_ui + runiform()
r; t=0.00 15:13:12

. 
.                          bysort firmid (year): replace fi = fi[_n-1] if _n > 1
(9900 real changes made)
r; t=0.00 15:13:12

. 
.         // # 8.1.5 build education and experience; education is a function of ui,
.         // the worker specific effect, as well as the instrument, q1
. 
.                 bysort workerid (year): gen educ= int(16*uniform())*ui if _n == 1
(9,009 missing values generated)
r; t=0.00 15:13:12

. 
.                         bysort workerid (year): replace educ = educ[_n-1] + round(uniform()) if _n > 1
(9,009 real changes made)
r; t=0.00 15:13:12

.                         egen sd = sd(educ),by(workerid)
r; t=0.00 15:13:12

.                                 sum sd, detail

                             sd
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .4772252              0
 5%     .6992059              0
10%     .8755951              0       Obs              10,000
25%     1.251666              0       Sum of Wgt.      10,000

50%     1.577621                      Mean           1.570987
                        Largest       Std. Dev.      .4993076
75%     1.892964        3.02765
90%     2.207426        3.02765       Variance        .249308
95%     2.403701        3.02765       Skewness      -.0334592
99%     2.733629        3.02765       Kurtosis       2.851623
r; t=0.00 15:13:12

.                                 drop sd
r; t=0.00 15:13:12

. 
.                 bysort workerid (year): gen exper= int(20*uniform()) if _n == 1
(9,009 missing values generated)
r; t=0.00 15:13:12

.                         bysort workerid (year): replace exper = exper[_n-1] + 1 if _n > 1
(9009 real changes made)
r; t=0.00 15:13:12

. 
.                         gen exper2 = exper^2
r; t=0.00 15:13:12

. 
.         // # 8.1.6 generate the true log wage equation, where the error term is
.         // defined by 'uniform()/ln(600)'; 600 is the minimum wage
.                 gen double lnwage = ln(600) + 0.06*educ + 0.007*exper - 0.00001*exper2 ///
>                                                         + 0.02*year + ui + fi + uniform()/ln(600)
r; t=0.00 15:13:12

. 
.         // 8.2. ESTIMATIONS
.         
.         tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        991        9.91        9.91
          2 |        991        9.91       19.82
          3 |        990        9.90       29.72
          4 |        990        9.90       39.62
          5 |        990        9.90       49.52
          6 |        990        9.90       59.42
          7 |        990        9.90       69.32
          8 |        990        9.90       79.22
          9 |        990        9.90       89.12
         10 |        990        9.90       99.02
         11 |         98        0.98      100.00
------------+-----------------------------------
      Total |     10,000      100.00
r; t=0.00 15:13:12

.         drop if year == 11
(98 observations deleted)
r; t=0.00 15:13:12

. 
.                 reg lnwage educ exper exper2 i.year

      Source |       SS           df       MS      Number of obs   =     9,902
-------------+----------------------------------   F(12, 9889)     =   1123.36
       Model |  2008.99415        12  167.416179   Prob > F        =    0.0000
    Residual |  1473.77351     9,889  .149031602   R-squared       =    0.5768
-------------+----------------------------------   Adj R-squared   =    0.5763
       Total |  3482.76766     9,901  .351759182   Root MSE        =    .38605

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1147564   .0010626   108.00   0.000     .1126735    .1168393
       exper |   .0027226    .002502     1.09   0.277    -.0021819    .0076271
      exper2 |   .0000793   .0000868     0.91   0.361    -.0000908    .0002495
             |
        year |
          2  |  -.0072606   .0173787    -0.42   0.676    -.0413264    .0268053
          3  |  -.0119756   .0174757    -0.69   0.493    -.0462315    .0222803
          4  |  -.0195988   .0176087    -1.11   0.266    -.0541154    .0149178
          5  |  -.0231497   .0177668    -1.30   0.193    -.0579762    .0116767
          6  |  -.0277367   .0179484    -1.55   0.122    -.0629192    .0074458
          7  |  -.0321494   .0181541    -1.77   0.077    -.0677351    .0034362
          8  |  -.0380392   .0183782    -2.07   0.038    -.0740642   -.0020141
          9  |  -.0454323   .0186303    -2.44   0.015    -.0819516   -.0089131
         10  |  -.0493224   .0189291    -2.61   0.009    -.0864273   -.0122176
             |
       _cons |   7.837236    .018755   417.87   0.000     7.800472    7.873999
------------------------------------------------------------------------------
r; t=0.02 15:13:12

.                         est store ols_firm
r; t=0.00 15:13:12

.                 
.                 xtreg lnwage educ exper exper2 i.year,fe
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      9,902
Group variable: workerid                        Number of groups  =        991

R-sq:                                           Obs per group:
     within  = 0.8693                                         min =          2
     between = 0.4126                                         avg =       10.0
     overall = 0.4466                                         max =         10

                                                F(11,8900)        =    5383.26
corr(u_i, Xb)  = 0.1837                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0610336   .0010702    57.03   0.000     .0589358    .0631313
       exper |   .0263638   .0008475    31.11   0.000     .0247026    .0280251
      exper2 |  -.0000198   .0000204    -0.97   0.333    -.0000597    .0000202
             |
        year |
          2  |  -.0008111    .002888    -0.28   0.779    -.0064722    .0048501
          3  |  -.0004892   .0027784    -0.18   0.860    -.0059355     .004957
          4  |  -.0023792   .0027052    -0.88   0.379     -.007682    .0029236
          5  |   -.001464   .0026684    -0.55   0.583    -.0066947    .0037666
          6  |  -.0004099   .0026685    -0.15   0.878    -.0056407    .0048209
          7  |   .0019934   .0027055     0.74   0.461    -.0033099    .0072968
          8  |   .0013814   .0027787     0.50   0.619    -.0040654    .0068283
          9  |  -.0014583   .0028893    -0.50   0.614    -.0071221    .0042054
         10  |          0  (omitted)
             |
       _cons |   7.828976   .0057514  1361.24   0.000     7.817702     7.84025
-------------+----------------------------------------------------------------
     sigma_u |  .44477948
     sigma_e |  .06760567
         rho |  .97741827   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(990, 8900) = 316.94                 Prob > F = 0.0000
r; t=0.07 15:13:12

.                         est store fe_firm
r; t=0.00 15:13:12

. 
.                 reghdfe lnwage educ exper exper2 i.year, absorb(FE1=workerid FE2=firmid)
you are using version 2.37.0 of ftools, but require version 2.39.1
r(9); t=0.39 15:13:12

end of do-file

r(9); t=2.30 15:13:12

. ssc install ftools
checking ftools consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
r; t=18.83 15:13:44

. do "C:\tmp\STD330c_000000.tmp"

.                 use ../data/data_simulation, clear
r; t=0.00 15:13:49

.                         //tab year, ge(yy)
.                                 set seed 234
r; t=0.00 15:13:49

. 
.                         drop lnwage
r; t=0.00 15:13:49

.                         bysort workerid (year): gen lnwage = ln(600) + ui + uniform()/ln(600) if _n == 1
(4,455 missing values generated)
r; t=0.00 15:13:49

.                                 bysort workerid (year): replace lnwage = ln(600) + 0.7*l.lnwage + ///
>                                         0.06*educ + 0.007*exper - 0.00001*exper2 + ///
>                                         0.02*year + ui + uniform()/ln(600) if _n > 1
(4,455 real changes made)
r; t=0.00 15:13:49

. 
.                                 
.                                 reg lnwage l.lnwage educ exper exper2 yy2-yy10
note: yy10 omitted because of collinearity

      Source |       SS           df       MS      Number of obs   =     4,455
-------------+----------------------------------   F(12, 4442)     >  99999.00
       Model |   77120.903        12  6426.74192   Prob > F        =    0.0000
    Residual |  79.3678256     4,442  .017867588   R-squared       =    0.9990
-------------+----------------------------------   Adj R-squared   =    0.9990
       Total |  77200.2709     4,454  17.3327954   Root MSE        =    .13367

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .9836796   .0028555   344.49   0.000     .9780815    .9892777
             |
        educ |   .0375438   .0008915    42.11   0.000     .0357961    .0392916
       exper |   .0083833   .0014262     5.88   0.000     .0055871    .0111794
      exper2 |  -.0002106   .0000477    -4.41   0.000    -.0003041   -.0001171
         yy2 |   4.606356   .0471831    97.63   0.000     4.513854    4.698859
         yy3 |    3.16024   .0330365    95.66   0.000     3.095472    3.225008
         yy4 |   2.151997   .0233522    92.15   0.000     2.106215    2.197779
         yy5 |   1.434819    .016872    85.04   0.000     1.401742    1.467897
         yy6 |   .9316663   .0127699    72.96   0.000      .906631    .9567015
         yy7 |   .5727817   .0103717    55.23   0.000      .552448    .5931154
         yy8 |   .3167439    .009148    34.62   0.000     .2988092    .3346787
         yy9 |   .1367309   .0086243    15.85   0.000     .1198229    .1536388
        yy10 |          0  (omitted)
       _cons |   .5163044   .0644233     8.01   0.000     .3900026    .6426062
------------------------------------------------------------------------------
r; t=0.71 15:13:49

.                                         est store ols_dd
r; t=0.00 15:13:49

. 
.                                 xtreg lnwage l.lnwage educ exper exper2 yy2-yy10, fe
note: yy9 omitted because of collinearity
note: yy10 omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,455
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9999                                         min =          9
     between = 0.9641                                         avg =        9.0
     overall = 0.9942                                         max =          9

                                                F(11,3949)        =   3.13e+06
corr(u_i, Xb)  = 0.1616                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .6948116   .0018414   377.32   0.000     .6912014    .6984218
             |
        educ |   .0614813   .0010956    56.12   0.000     .0593333    .0636294
       exper |   .0277517   .0031964     8.68   0.000      .021485    .0340184
      exper2 |  -.0000237   .0000228    -1.04   0.300    -.0000684    .0000211
         yy2 |  -.0803705   .0316446    -2.54   0.011    -.1424119   -.0183291
         yy3 |  -.0581077     .02381    -2.44   0.015    -.1047887   -.0114266
         yy4 |  -.0347071   .0182881    -1.90   0.058    -.0705622     .001148
         yy5 |  -.0237648   .0141219    -1.68   0.092    -.0514517    .0039222
         yy6 |  -.0140279   .0107125    -1.31   0.190    -.0350304    .0069746
         yy7 |  -.0090185   .0077131    -1.17   0.242    -.0241405    .0061035
         yy8 |  -.0067363   .0050081    -1.35   0.179    -.0165549    .0030824
         yy9 |          0  (omitted)
        yy10 |          0  (omitted)
       _cons |      6.892   .0587294   117.35   0.000     6.776857    7.007143
-------------+----------------------------------------------------------------
     sigma_u |  .31784188
     sigma_e |  .04539399
         rho |  .98001035   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 3949) = 74.39                  Prob > F = 0.0000
r; t=0.06 15:13:49

.                                         est store fe_dd
r; t=0.00 15:13:49

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy3-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy3-yy10) ar(2) noleveleq
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      3960
Time variable : year                            Number of groups   =       495
Number of instruments = 24                      Obs per group: min =         8
Wald chi2(11) =  3.33e+07                                      avg =      8.00
Prob > chi2   =     0.000                                      max =         8
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .7005175   .0042826   163.57   0.000     .6921238    .7089111
             |
        educ |   .0516894   .0259735     1.99   0.047     .0007824    .1025965
       exper |   .0301968   .0063899     4.73   0.000     .0176729    .0427208
      exper2 |  -.0000425   .0000269    -1.58   0.114    -.0000952    .0000102
         yy3 |  -.0050758   .0121533    -0.42   0.676     -.028896    .0187443
         yy4 |  -.0003674   .0174347    -0.02   0.983    -.0345389     .033804
         yy5 |  -.0019996   .0180997    -0.11   0.912    -.0374744    .0334752
         yy6 |   -.000185   .0147282    -0.01   0.990    -.0290518    .0286817
         yy7 |   8.97e-06   .0089651     0.00   0.999    -.0175623    .0175802
         yy9 |   .0054254   .0090514     0.60   0.549    -.0123151    .0231659
        yy10 |   .0050307    .017783     0.28   0.777    -.0298234    .0398848
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -25.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.39  Pr > z =  0.166
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(13)   =  12.86  Prob > chi2 =  0.458
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  gmm(lnwage, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  11.69  Prob > chi2 =  0.232
    Difference (null H = exogenous): chi2(4)    =   1.18  Prob > chi2 =  0.882
  gmm(educ, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  10.66  Prob > chi2 =  0.300
    Difference (null H = exogenous): chi2(4)    =   2.20  Prob > chi2 =  0.699
  gmm(exper exper2, collapse lag(0 5))
    Sargan test excluding group:     chi2(4)    =   4.14  Prob > chi2 =  0.387
    Difference (null H = exogenous): chi2(9)    =   8.72  Prob > chi2 =  0.464
  iv(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
    Sargan test excluding group:     chi2(6)    =   6.38  Prob > chi2 =  0.382
    Difference (null H = exogenous): chi2(7)    =   6.48  Prob > chi2 =  0.485

r; t=1.49 15:13:51

.                                                 est store fd_dd
r; t=0.00 15:13:51

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy2-yy10, eq(level)) ar(2) robust small
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate robust weighting matrix for Hansen test.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, one-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 28                      Obs per group: min =         9
F(12, 494)    = 470976.61                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |    .734721   .0067293   109.18   0.000     .7214994    .7479427
             |
        educ |   .1276313   .0028706    44.46   0.000     .1219912    .1332714
       exper |   .0068942   .0023591     2.92   0.004     .0022592    .0115293
      exper2 |  -.0000441   .0000672    -0.66   0.512    -.0001761    .0000879
         yy2 |   .6222577   .1051077     5.92   0.000     .4157445    .8287709
         yy3 |   .4287794   .0706237     6.07   0.000     .2900195    .5675394
         yy4 |   .2968444   .0463087     6.41   0.000     .2058581    .3878308
         yy5 |   .1936889    .028958     6.69   0.000      .136793    .2505849
         yy6 |   .1162911   .0165353     7.03   0.000      .083803    .1487793
         yy7 |   .0537439   .0076796     7.00   0.000     .0386552    .0688327
         yy9 |  -.0359565   .0063771    -5.64   0.000     -.048486    -.023427
        yy10 |  -.0709887     .01032    -6.88   0.000    -.0912652   -.0507122
       _cons |   5.904665   .1503296    39.28   0.000     5.609301    6.200029
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL.(exper exper2) collapsed
    DL.educ collapsed
    DL.lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -15.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.65  Pr > z =  0.100
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(15)   =4236.57  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(15)   = 144.27  Prob > chi2 =  0.000
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(11)   =   8.35  Prob > chi2 =  0.681
    Difference (null H = exogenous): chi2(4)    = 135.92  Prob > chi2 =  0.000
  gmm(lnwage, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   6.89  Prob > chi2 =  0.735
    Difference (null H = exogenous): chi2(5)    = 137.38  Prob > chi2 =  0.000
  gmm(educ, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   9.15  Prob > chi2 =  0.518
    Difference (null H = exogenous): chi2(5)    = 135.12  Prob > chi2 =  0.000
  gmm(exper exper2, collapse lag(0 5))
    Hansen test excluding group:     chi2(4)    =   5.69  Prob > chi2 =  0.224
    Difference (null H = exogenous): chi2(11)   = 138.58  Prob > chi2 =  0.000
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(8)    =  17.24  Prob > chi2 =  0.028
    Difference (null H = exogenous): chi2(7)    = 127.02  Prob > chi2 =  0.000

r; t=0.94 15:13:52

.                                                 est store sys_dd
r; t=0.00 15:13:52

. 
.                                 est table ols_dd fe_dd fd_dd sys_dd, star(.1 .05 .02) drop(yy* _cons) ///
>                                         stats(r2 ll sargan sarganp hansen hansenp) b(%5.4f) title(Dynamic Growth regressions)

Dynamic Growth regressions

------------------------------------------------------------------
    Variable |   ols_dd       fe_dd        fd_dd        sys_dd    
-------------+----------------------------------------------------
      lnwage |
         L1. |  0.9837***    0.6948***    0.7005***    0.7347***  
             |
        educ |  0.0375***    0.0615***    0.0517**     0.1276***  
       exper |  0.0084***    0.0278***    0.0302***    0.0069***  
      exper2 | -0.0002***   -0.0000      -0.0000      -0.0000     
-------------+----------------------------------------------------
          r2 |  0.9990       0.9999                               
          ll | 2.7e+03      7.7e+03                               
      sargan |                           12.8629      4.2e+03     
     sarganp |                            0.4585       0.0000     
      hansen |                                        144.2691     
     hansenp |                                         0.0000     
------------------------------------------------------------------
                               legend: * p<.1; ** p<.05; *** p<.02
r; t=0.13 15:13:52

. 
. 
.                 esttab ols_dd fe_dd fd_dd sys_dd using ../tex_paper/estimation_gmm_analysis.tex, replace ///
>                         keep(educ exper exper2) ///
>                         mtitle("OLS" "FE" "GMM-FD" "GMM-Sys") nonumbers ///
>                         coeflabel (educ Education exper "Experience" exper2 "Experience sq.") ///
>                         b(%5.4f) se(%5.4f) star(* 0.1 ** 0.05 *** 0.01) ///
>                                 scalars("N Observations" "N_g Workers" ///
>                                 "r2 \$R^{2}\$" "rmse Root MSE" ///
>                                 "ar1 AR(1)" "ar1p p-value" "ar2 AR(2)" "ar2p p-value" ///
>                                 "hansen Hansen" "hansen_df df" "hansenp H p-value") ///
>                         nonotes addnotes("Notes: standard errors in parenthesis. Significance levels: *, 10\%;" "**, 5\%; ***, 1\%. The dependent variable is ln
>  real GDP per workers." "Source: own computations.")
(output written to ../tex_paper/estimation_gmm_analysis.tex)
r; t=0.10 15:13:52

. 
. // # 8. High-Dimensional Fixed-Effects
. 
. clear
r; t=0.00 15:13:52

. 
. // # 8.1. build simulated data
. 
.         set obs 10000                   //      define the number of observations
number of observations (_N) was 0, now 10,000
r; t=0.00 15:13:52

.         set seed 345567789              //      define the 'seed' in order to be able
r; t=0.00 15:13:52

.                                                         //      to replicate the results
. 
.         // # 8.1.1 define worker's id and year of observation
.                 
.                 gen workerid = int(_n/10.1)+1
r; t=0.00 15:13:52

.                 bysort workerid: gen year = _n
r; t=0.00 15:13:52

. 
.         // # 8.1.2 define firms's id
.         
.                 gen firmid = int(_n/100.1)+1
r; t=0.00 15:13:52

. 
.                 sort workerid year
r; t=0.00 15:13:52

.                 tsset workerid year
       panel variable:  workerid (unbalanced)
        time variable:  year, 1 to 11
                delta:  1 unit
r; t=0.01 15:13:52

. 
.         // # 8.1.3 generate individual's specific effect, ui
.                 bysort workerid (year): gen double ui = runiform() if _n == 1
(9,009 missing values generated)
r; t=0.00 15:13:52

.                          bysort workerid (year): replace ui = ui[_n-1] if _n > 1
(9009 real changes made)
r; t=0.00 15:13:52

. 
.         // # 8.1.4 generate individual's specific effect, ui
.                 
.                 // bysort firmid (year): gen double fi = runiform() if _n == 1
.                 // bysort firmid (year): replace fi = fi[_n-1] if _n > 1
. 
.                          egen mean_ui = mean(ui),by(firmid)
r; t=0.00 15:13:52

. 
.                                 gen fi = mean_ui + runiform()
r; t=0.00 15:13:52

. 
.                          bysort firmid (year): replace fi = fi[_n-1] if _n > 1
(9900 real changes made)
r; t=0.00 15:13:52

. 
.         // # 8.1.5 build education and experience; education is a function of ui,
.         // the worker specific effect, as well as the instrument, q1
. 
.                 bysort workerid (year): gen educ= int(16*uniform())*ui if _n == 1
(9,009 missing values generated)
r; t=0.01 15:13:52

. 
.                         bysort workerid (year): replace educ = educ[_n-1] + round(uniform()) if _n > 1
(9,009 real changes made)
r; t=0.00 15:13:52

.                         egen sd = sd(educ),by(workerid)
r; t=0.00 15:13:52

.                                 sum sd, detail

                             sd
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .4772252              0
 5%     .6992059              0
10%     .8755951              0       Obs              10,000
25%     1.251666              0       Sum of Wgt.      10,000

50%     1.577621                      Mean           1.570987
                        Largest       Std. Dev.      .4993076
75%     1.892964        3.02765
90%     2.207426        3.02765       Variance        .249308
95%     2.403701        3.02765       Skewness      -.0334592
99%     2.733629        3.02765       Kurtosis       2.851623
r; t=0.00 15:13:52

.                                 drop sd
r; t=0.00 15:13:52

. 
.                 bysort workerid (year): gen exper= int(20*uniform()) if _n == 1
(9,009 missing values generated)
r; t=0.00 15:13:52

.                         bysort workerid (year): replace exper = exper[_n-1] + 1 if _n > 1
(9009 real changes made)
r; t=0.00 15:13:52

. 
.                         gen exper2 = exper^2
r; t=0.00 15:13:52

. 
.         // # 8.1.6 generate the true log wage equation, where the error term is
.         // defined by 'uniform()/ln(600)'; 600 is the minimum wage
.                 gen double lnwage = ln(600) + 0.06*educ + 0.007*exper - 0.00001*exper2 ///
>                                                         + 0.02*year + ui + fi + uniform()/ln(600)
r; t=0.00 15:13:52

. 
.         // 8.2. ESTIMATIONS
.         
.         tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        991        9.91        9.91
          2 |        991        9.91       19.82
          3 |        990        9.90       29.72
          4 |        990        9.90       39.62
          5 |        990        9.90       49.52
          6 |        990        9.90       59.42
          7 |        990        9.90       69.32
          8 |        990        9.90       79.22
          9 |        990        9.90       89.12
         10 |        990        9.90       99.02
         11 |         98        0.98      100.00
------------+-----------------------------------
      Total |     10,000      100.00
r; t=0.00 15:13:52

.         drop if year == 11
(98 observations deleted)
r; t=0.00 15:13:52

. 
.                 reg lnwage educ exper exper2 i.year

      Source |       SS           df       MS      Number of obs   =     9,902
-------------+----------------------------------   F(12, 9889)     =   1181.82
       Model |  1980.98422        12  165.082018   Prob > F        =    0.0000
    Residual |  1381.34417     9,889   .13968492   R-squared       =    0.5892
-------------+----------------------------------   Adj R-squared   =    0.5887
       Total |  3362.32839     9,901  .339594828   Root MSE        =    .37374

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1136466   .0010287   110.47   0.000     .1116301    .1156631
       exper |  -.0037341   .0024223    -1.54   0.123    -.0084823    .0010141
      exper2 |   .0003305    .000084     3.93   0.000     .0001658    .0004952
             |
        year |
          2  |  -.0046619   .0168249    -0.28   0.782    -.0376422    .0283184
          3  |  -.0059876   .0169188    -0.35   0.723     -.039152    .0271767
          4  |  -.0108047   .0170476    -0.63   0.526    -.0442214     .022612
          5  |  -.0154237   .0172006    -0.90   0.370    -.0491404     .018293
          6  |  -.0205696   .0173765    -1.18   0.237     -.054631    .0134918
          7  |  -.0276632   .0175756    -1.57   0.116    -.0621149    .0067884
          8  |  -.0327544   .0177926    -1.84   0.066    -.0676315    .0021226
          9  |  -.0412618   .0180367    -2.29   0.022    -.0766173   -.0059063
         10  |  -.0496883   .0183259    -2.71   0.007    -.0856108   -.0137658
             |
       _cons |   7.872944   .0181574   433.60   0.000     7.837352    7.908537
------------------------------------------------------------------------------
r; t=0.02 15:13:52

.                         est store ols_firm
r; t=0.00 15:13:52

.                 
.                 xtreg lnwage educ exper exper2 i.year,fe
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      9,902
Group variable: workerid                        Number of groups  =        991

R-sq:                                           Obs per group:
     within  = 0.8598                                         min =          2
     between = 0.4050                                         avg =       10.0
     overall = 0.4410                                         max =         10

                                                F(11,8900)        =    4961.57
corr(u_i, Xb)  = 0.1728                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0583425   .0011105    52.54   0.000     .0561657    .0605193
       exper |   .0264297   .0008794    30.05   0.000     .0247058    .0281536
      exper2 |   .0000233   .0000212     1.10   0.272    -.0000182    .0000647
             |
        year |
          2  |   .0002009   .0029969     0.07   0.947    -.0056737    .0060754
          3  |   .0028429   .0028831     0.99   0.324    -.0028086    .0084945
          4  |    .002969   .0028072     1.06   0.290    -.0025337    .0084716
          5  |   .0023993    .002769     0.87   0.386    -.0030285    .0078271
          6  |   .0029226    .002769     1.06   0.291    -.0025054    .0083505
          7  |   .0031182   .0028074     1.11   0.267     -.002385    .0086214
          8  |   .0041431   .0028834     1.44   0.151     -.001509    .0097953
          9  |   .0014167   .0029983     0.47   0.637    -.0044606    .0072939
         10  |          0  (omitted)
             |
       _cons |   7.834669   .0059681  1312.75   0.000      7.82297    7.846368
-------------+----------------------------------------------------------------
     sigma_u |  .43770959
     sigma_e |  .07015385
         rho |  .97495532   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(990, 8900) = 274.73                 Prob > F = 0.0000
r; t=0.07 15:13:52

.                         est store fe_firm
r; t=0.00 15:13:52

. 
.                 reghdfe lnwage educ exper exper2 i.year, absorb(FE1=workerid FE2=firmid)
you are using version 2.37.0 of ftools, but require version 2.39.1
r(9); t=0.16 15:13:52

end of do-file

r(9); t=3.74 15:13:52

. ssc install ftools
checking ftools consistency and verifying not already installed...
could not copy http://fmwww.bc.edu/repec/bocode/l/local_inlist.ado
(no action taken)
--Break--
r(1); t=8.65 15:14:11

. ssc install ftools, replace
checking ftools consistency and verifying not already installed...
all files already exist and are up to date.
r; t=23.64 15:14:38

. do "C:\tmp\STD330c_000000.tmp"

.                 use ../data/data_simulation, clear
r; t=0.00 15:14:45

.                         //tab year, ge(yy)
.                                 set seed 234
r; t=0.00 15:14:45

. 
.                         drop lnwage
r; t=0.00 15:14:45

.                         bysort workerid (year): gen lnwage = ln(600) + ui + uniform()/ln(600) if _n == 1
(4,455 missing values generated)
r; t=0.00 15:14:45

.                                 bysort workerid (year): replace lnwage = ln(600) + 0.7*l.lnwage + ///
>                                         0.06*educ + 0.007*exper - 0.00001*exper2 + ///
>                                         0.02*year + ui + uniform()/ln(600) if _n > 1
(4,455 real changes made)
r; t=0.00 15:14:45

. 
.                                 
.                                 reg lnwage l.lnwage educ exper exper2 yy2-yy10
note: yy10 omitted because of collinearity

      Source |       SS           df       MS      Number of obs   =     4,455
-------------+----------------------------------   F(12, 4442)     >  99999.00
       Model |   77120.903        12  6426.74192   Prob > F        =    0.0000
    Residual |  79.3678256     4,442  .017867588   R-squared       =    0.9990
-------------+----------------------------------   Adj R-squared   =    0.9990
       Total |  77200.2709     4,454  17.3327954   Root MSE        =    .13367

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .9836796   .0028555   344.49   0.000     .9780815    .9892777
             |
        educ |   .0375438   .0008915    42.11   0.000     .0357961    .0392916
       exper |   .0083833   .0014262     5.88   0.000     .0055871    .0111794
      exper2 |  -.0002106   .0000477    -4.41   0.000    -.0003041   -.0001171
         yy2 |   4.606356   .0471831    97.63   0.000     4.513854    4.698859
         yy3 |    3.16024   .0330365    95.66   0.000     3.095472    3.225008
         yy4 |   2.151997   .0233522    92.15   0.000     2.106215    2.197779
         yy5 |   1.434819    .016872    85.04   0.000     1.401742    1.467897
         yy6 |   .9316663   .0127699    72.96   0.000      .906631    .9567015
         yy7 |   .5727817   .0103717    55.23   0.000      .552448    .5931154
         yy8 |   .3167439    .009148    34.62   0.000     .2988092    .3346787
         yy9 |   .1367309   .0086243    15.85   0.000     .1198229    .1536388
        yy10 |          0  (omitted)
       _cons |   .5163044   .0644233     8.01   0.000     .3900026    .6426062
------------------------------------------------------------------------------
r; t=0.77 15:14:46

.                                         est store ols_dd
r; t=0.00 15:14:46

. 
.                                 xtreg lnwage l.lnwage educ exper exper2 yy2-yy10, fe
note: yy9 omitted because of collinearity
note: yy10 omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      4,455
Group variable: workerid                        Number of groups  =        495

R-sq:                                           Obs per group:
     within  = 0.9999                                         min =          9
     between = 0.9641                                         avg =        9.0
     overall = 0.9942                                         max =          9

                                                F(11,3949)        =   3.13e+06
corr(u_i, Xb)  = 0.1616                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .6948116   .0018414   377.32   0.000     .6912014    .6984218
             |
        educ |   .0614813   .0010956    56.12   0.000     .0593333    .0636294
       exper |   .0277517   .0031964     8.68   0.000      .021485    .0340184
      exper2 |  -.0000237   .0000228    -1.04   0.300    -.0000684    .0000211
         yy2 |  -.0803705   .0316446    -2.54   0.011    -.1424119   -.0183291
         yy3 |  -.0581077     .02381    -2.44   0.015    -.1047887   -.0114266
         yy4 |  -.0347071   .0182881    -1.90   0.058    -.0705622     .001148
         yy5 |  -.0237648   .0141219    -1.68   0.092    -.0514517    .0039222
         yy6 |  -.0140279   .0107125    -1.31   0.190    -.0350304    .0069746
         yy7 |  -.0090185   .0077131    -1.17   0.242    -.0241405    .0061035
         yy8 |  -.0067363   .0050081    -1.35   0.179    -.0165549    .0030824
         yy9 |          0  (omitted)
        yy10 |          0  (omitted)
       _cons |      6.892   .0587294   117.35   0.000     6.776857    7.007143
-------------+----------------------------------------------------------------
     sigma_u |  .31784188
     sigma_e |  .04539399
         rho |  .98001035   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(494, 3949) = 74.39                  Prob > F = 0.0000
r; t=0.05 15:14:46

.                                         est store fe_dd
r; t=0.00 15:14:46

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy3-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy3-yy10) ar(2) noleveleq
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      3960
Time variable : year                            Number of groups   =       495
Number of instruments = 24                      Obs per group: min =         8
Wald chi2(11) =  3.33e+07                                      avg =      8.00
Prob > chi2   =     0.000                                      max =         8
------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |   .7005175   .0042826   163.57   0.000     .6921238    .7089111
             |
        educ |   .0516894   .0259735     1.99   0.047     .0007824    .1025965
       exper |   .0301968   .0063899     4.73   0.000     .0176729    .0427208
      exper2 |  -.0000425   .0000269    -1.58   0.114    -.0000952    .0000102
         yy3 |  -.0050758   .0121533    -0.42   0.676     -.028896    .0187443
         yy4 |  -.0003674   .0174347    -0.02   0.983    -.0345389     .033804
         yy5 |  -.0019996   .0180997    -0.11   0.912    -.0374744    .0334752
         yy6 |   -.000185   .0147282    -0.01   0.990    -.0290518    .0286817
         yy7 |   8.97e-06   .0089651     0.00   0.999    -.0175623    .0175802
         yy9 |   .0054254   .0090514     0.60   0.549    -.0123151    .0231659
        yy10 |   .0050307    .017783     0.28   0.777    -.0298234    .0398848
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -25.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.39  Pr > z =  0.166
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(13)   =  12.86  Prob > chi2 =  0.458
  (Not robust, but not weakened by many instruments.)

Difference-in-Sargan tests of exogeneity of instrument subsets:
  gmm(lnwage, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  11.69  Prob > chi2 =  0.232
    Difference (null H = exogenous): chi2(4)    =   1.18  Prob > chi2 =  0.882
  gmm(educ, collapse lag(2 5))
    Sargan test excluding group:     chi2(9)    =  10.66  Prob > chi2 =  0.300
    Difference (null H = exogenous): chi2(4)    =   2.20  Prob > chi2 =  0.699
  gmm(exper exper2, collapse lag(0 5))
    Sargan test excluding group:     chi2(4)    =   4.14  Prob > chi2 =  0.387
    Difference (null H = exogenous): chi2(9)    =   8.72  Prob > chi2 =  0.464
  iv(yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10)
    Sargan test excluding group:     chi2(6)    =   6.38  Prob > chi2 =  0.382
    Difference (null H = exogenous): chi2(7)    =   6.48  Prob > chi2 =  0.485

r; t=1.59 15:14:48

.                                                 est store fd_dd
r; t=0.00 15:14:48

. 
.                                 xtabond2 lnwage l.lnwage educ exper exper2 yy2-yy10, ///
>                                         gmm(lnwage, lag(2 5) collapse) gmm(educ, lag(2 5) collapse) ///
>                                         gmm(exper exper2, lag(0 5) collapse) iv(yy2-yy10, eq(level)) ar(2) robust small
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
yy8 dropped due to collinearity
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate robust weighting matrix for Hansen test.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, one-step system GMM
------------------------------------------------------------------------------
Group variable: workerid                        Number of obs      =      4455
Time variable : year                            Number of groups   =       495
Number of instruments = 28                      Obs per group: min =         9
F(12, 494)    = 470976.61                                      avg =      9.00
Prob > F      =     0.000                                      max =         9
------------------------------------------------------------------------------
             |               Robust
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnwage |
         L1. |    .734721   .0067293   109.18   0.000     .7214994    .7479427
             |
        educ |   .1276313   .0028706    44.46   0.000     .1219912    .1332714
       exper |   .0068942   .0023591     2.92   0.004     .0022592    .0115293
      exper2 |  -.0000441   .0000672    -0.66   0.512    -.0001761    .0000879
         yy2 |   .6222577   .1051077     5.92   0.000     .4157445    .8287709
         yy3 |   .4287794   .0706237     6.07   0.000     .2900195    .5675394
         yy4 |   .2968444   .0463087     6.41   0.000     .2058581    .3878308
         yy5 |   .1936889    .028958     6.69   0.000      .136793    .2505849
         yy6 |   .1162911   .0165353     7.03   0.000      .083803    .1487793
         yy7 |   .0537439   .0076796     7.00   0.000     .0386552    .0688327
         yy9 |  -.0359565   .0063771    -5.64   0.000     -.048486    -.023427
        yy10 |  -.0709887     .01032    -6.88   0.000    -.0912652   -.0507122
       _cons |   5.904665   .1503296    39.28   0.000     5.609301    6.200029
------------------------------------------------------------------------------
Instruments for first differences equation
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(0/5).(exper exper2) collapsed
    L(2/5).educ collapsed
    L(2/5).lnwage collapsed
Instruments for levels equation
  Standard
    yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10
    _cons
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    DL.(exper exper2) collapsed
    DL.educ collapsed
    DL.lnwage collapsed
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z = -15.05  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.65  Pr > z =  0.100
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(15)   =4236.57  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(15)   = 144.27  Prob > chi2 =  0.000
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  GMM instruments for levels
    Hansen test excluding group:     chi2(11)   =   8.35  Prob > chi2 =  0.681
    Difference (null H = exogenous): chi2(4)    = 135.92  Prob > chi2 =  0.000
  gmm(lnwage, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   6.89  Prob > chi2 =  0.735
    Difference (null H = exogenous): chi2(5)    = 137.38  Prob > chi2 =  0.000
  gmm(educ, collapse lag(2 5))
    Hansen test excluding group:     chi2(10)   =   9.15  Prob > chi2 =  0.518
    Difference (null H = exogenous): chi2(5)    = 135.12  Prob > chi2 =  0.000
  gmm(exper exper2, collapse lag(0 5))
    Hansen test excluding group:     chi2(4)    =   5.69  Prob > chi2 =  0.224
    Difference (null H = exogenous): chi2(11)   = 138.58  Prob > chi2 =  0.000
  iv(yy2 yy3 yy4 yy5 yy6 yy7 yy8 yy9 yy10, eq(level))
    Hansen test excluding group:     chi2(8)    =  17.24  Prob > chi2 =  0.028
    Difference (null H = exogenous): chi2(7)    = 127.02  Prob > chi2 =  0.000

r; t=0.97 15:14:48

.                                                 est store sys_dd
r; t=0.00 15:14:48

. 
.                                 est table ols_dd fe_dd fd_dd sys_dd, star(.1 .05 .02) drop(yy* _cons) ///
>                                         stats(r2 ll sargan sarganp hansen hansenp) b(%5.4f) title(Dynamic Growth regressions)

Dynamic Growth regressions

------------------------------------------------------------------
    Variable |   ols_dd       fe_dd        fd_dd        sys_dd    
-------------+----------------------------------------------------
      lnwage |
         L1. |  0.9837***    0.6948***    0.7005***    0.7347***  
             |
        educ |  0.0375***    0.0615***    0.0517**     0.1276***  
       exper |  0.0084***    0.0278***    0.0302***    0.0069***  
      exper2 | -0.0002***   -0.0000      -0.0000      -0.0000     
-------------+----------------------------------------------------
          r2 |  0.9990       0.9999                               
          ll | 2.7e+03      7.7e+03                               
      sargan |                           12.8629      4.2e+03     
     sarganp |                            0.4585       0.0000     
      hansen |                                        144.2691     
     hansenp |                                         0.0000     
------------------------------------------------------------------
                               legend: * p<.1; ** p<.05; *** p<.02
r; t=0.13 15:14:49

. 
. 
.                 esttab ols_dd fe_dd fd_dd sys_dd using ../tex_paper/estimation_gmm_analysis.tex, replace ///
>                         keep(educ exper exper2) ///
>                         mtitle("OLS" "FE" "GMM-FD" "GMM-Sys") nonumbers ///
>                         coeflabel (educ Education exper "Experience" exper2 "Experience sq.") ///
>                         b(%5.4f) se(%5.4f) star(* 0.1 ** 0.05 *** 0.01) ///
>                                 scalars("N Observations" "N_g Workers" ///
>                                 "r2 \$R^{2}\$" "rmse Root MSE" ///
>                                 "ar1 AR(1)" "ar1p p-value" "ar2 AR(2)" "ar2p p-value" ///
>                                 "hansen Hansen" "hansen_df df" "hansenp H p-value") ///
>                         nonotes addnotes("Notes: standard errors in parenthesis. Significance levels: *, 10\%;" "**, 5\%; ***, 1\%. The dependent variable is ln
>  real GDP per workers." "Source: own computations.")
(output written to ../tex_paper/estimation_gmm_analysis.tex)
r; t=0.10 15:14:49

. 
. // # 8. High-Dimensional Fixed-Effects
. 
. clear
r; t=0.00 15:14:49

. 
. // # 8.1. build simulated data
. 
.         set obs 10000                   //      define the number of observations
number of observations (_N) was 0, now 10,000
r; t=0.00 15:14:49

.         set seed 345567789              //      define the 'seed' in order to be able
r; t=0.00 15:14:49

.                                                         //      to replicate the results
. 
.         // # 8.1.1 define worker's id and year of observation
.                 
.                 gen workerid = int(_n/10.1)+1
r; t=0.00 15:14:49

.                 bysort workerid: gen year = _n
r; t=0.00 15:14:49

. 
.         // # 8.1.2 define firms's id
.         
.                 gen firmid = int(_n/100.1)+1
r; t=0.00 15:14:49

. 
.                 sort workerid year
r; t=0.00 15:14:49

.                 tsset workerid year
       panel variable:  workerid (unbalanced)
        time variable:  year, 1 to 11
                delta:  1 unit
r; t=0.01 15:14:49

. 
.         // # 8.1.3 generate individual's specific effect, ui
.                 bysort workerid (year): gen double ui = runiform() if _n == 1
(9,009 missing values generated)
r; t=0.00 15:14:49

.                          bysort workerid (year): replace ui = ui[_n-1] if _n > 1
(9009 real changes made)
r; t=0.00 15:14:49

. 
.         // # 8.1.4 generate individual's specific effect, ui
.                 
.                 // bysort firmid (year): gen double fi = runiform() if _n == 1
.                 // bysort firmid (year): replace fi = fi[_n-1] if _n > 1
. 
.                          egen mean_ui = mean(ui),by(firmid)
r; t=0.00 15:14:49

. 
.                                 gen fi = mean_ui + runiform()
r; t=0.00 15:14:49

. 
.                          bysort firmid (year): replace fi = fi[_n-1] if _n > 1
(9900 real changes made)
r; t=0.00 15:14:49

. 
.         // # 8.1.5 build education and experience; education is a function of ui,
.         // the worker specific effect, as well as the instrument, q1
. 
.                 bysort workerid (year): gen educ= int(16*uniform())*ui if _n == 1
(9,009 missing values generated)
r; t=0.00 15:14:49

. 
.                         bysort workerid (year): replace educ = educ[_n-1] + round(uniform()) if _n > 1
(9,009 real changes made)
r; t=0.00 15:14:49

.                         egen sd = sd(educ),by(workerid)
r; t=0.00 15:14:49

.                                 sum sd, detail

                             sd
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .4772252              0
 5%     .6992059              0
10%     .8755951              0       Obs              10,000
25%     1.251666              0       Sum of Wgt.      10,000

50%     1.577621                      Mean           1.570987
                        Largest       Std. Dev.      .4993076
75%     1.892964        3.02765
90%     2.207426        3.02765       Variance        .249308
95%     2.403701        3.02765       Skewness      -.0334592
99%     2.733629        3.02765       Kurtosis       2.851623
r; t=0.00 15:14:49

.                                 drop sd
r; t=0.00 15:14:49

. 
.                 bysort workerid (year): gen exper= int(20*uniform()) if _n == 1
(9,009 missing values generated)
r; t=0.00 15:14:49

.                         bysort workerid (year): replace exper = exper[_n-1] + 1 if _n > 1
(9009 real changes made)
r; t=0.00 15:14:49

. 
.                         gen exper2 = exper^2
r; t=0.00 15:14:49

. 
.         // # 8.1.6 generate the true log wage equation, where the error term is
.         // defined by 'uniform()/ln(600)'; 600 is the minimum wage
.                 gen double lnwage = ln(600) + 0.06*educ + 0.007*exper - 0.00001*exper2 ///
>                                                         + 0.02*year + ui + fi + uniform()/ln(600)
r; t=0.00 15:14:49

. 
.         // 8.2. ESTIMATIONS
.         
.         tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        991        9.91        9.91
          2 |        991        9.91       19.82
          3 |        990        9.90       29.72
          4 |        990        9.90       39.62
          5 |        990        9.90       49.52
          6 |        990        9.90       59.42
          7 |        990        9.90       69.32
          8 |        990        9.90       79.22
          9 |        990        9.90       89.12
         10 |        990        9.90       99.02
         11 |         98        0.98      100.00
------------+-----------------------------------
      Total |     10,000      100.00
r; t=0.00 15:14:49

.         drop if year == 11
(98 observations deleted)
r; t=0.00 15:14:49

. 
.                 reg lnwage educ exper exper2 i.year

      Source |       SS           df       MS      Number of obs   =     9,902
-------------+----------------------------------   F(12, 9889)     =   1020.65
       Model |  2031.10191        12  169.258492   Prob > F        =    0.0000
    Residual |  1639.93691     9,889  .165834453   R-squared       =    0.5533
-------------+----------------------------------   Adj R-squared   =    0.5527
       Total |  3671.03882     9,901   .37077455   Root MSE        =    .40723

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .1152937   .0011209   102.86   0.000     .1130965    .1174909
       exper |  -.0048481   .0026393    -1.84   0.066    -.0100217    .0003255
      exper2 |   .0003644   .0000916     3.98   0.000     .0001849    .0005439
             |
        year |
          2  |  -.0030987   .0183323    -0.17   0.866    -.0390336    .0328363
          3  |  -.0072712   .0184346    -0.39   0.693    -.0434067    .0288643
          4  |  -.0121887   .0185748    -0.66   0.512    -.0485992    .0242217
          5  |   -.018217   .0187416    -0.97   0.331    -.0549543    .0185204
          6  |  -.0229368   .0189332    -1.21   0.226    -.0600497    .0141761
          7  |  -.0298349   .0191501    -1.56   0.119     -.067373    .0077033
          8  |  -.0374905   .0193866    -1.93   0.053    -.0754922    .0005112
          9  |  -.0458876   .0196525    -2.33   0.020    -.0844106   -.0073646
         10  |  -.0539625   .0199677    -2.70   0.007    -.0931033   -.0148218
             |
       _cons |   7.863276   .0197841   397.46   0.000     7.824496    7.902057
------------------------------------------------------------------------------
r; t=0.03 15:14:49

.                         est store ols_firm
r; t=0.00 15:14:49

.                 
.                 xtreg lnwage educ exper exper2 i.year,fe
note: 10.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      9,902
Group variable: workerid                        Number of groups  =        991

R-sq:                                           Obs per group:
     within  = 0.8288                                         min =          2
     between = 0.3915                                         avg =       10.0
     overall = 0.4234                                         max =         10

                                                F(11,8900)        =    3916.22
corr(u_i, Xb)  = 0.1767                         Prob > F          =     0.0000

------------------------------------------------------------------------------
      lnwage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        educ |   .0602812   .0012535    48.09   0.000     .0578241    .0627383
       exper |   .0254907   .0009927    25.68   0.000     .0235448    .0274365
      exper2 |   .0000303   .0000239     1.27   0.204    -.0000165    .0000771
             |
        year |
          2  |   .0019658   .0033827     0.58   0.561    -.0046651    .0085968
          3  |   .0024692   .0032543     0.76   0.448    -.0039101    .0088484
          4  |   .0028094   .0031686     0.89   0.375    -.0034018    .0090206
          5  |   .0012067   .0031255     0.39   0.699      -.00492    .0073334
          6  |   .0025807   .0031256     0.83   0.409    -.0035462    .0087076
          7  |   .0034449   .0031689     1.09   0.277    -.0027669    .0096567
          8  |   .0024414   .0032547     0.75   0.453    -.0039386    .0088213
          9  |   .0004199   .0033843     0.12   0.901    -.0062141    .0070539
         10  |          0  (omitted)
             |
       _cons |    7.82517   .0067366  1161.59   0.000     7.811965    7.838376
-------------+----------------------------------------------------------------
     sigma_u |  .46362252
     sigma_e |  .07918691
         rho |  .97165415   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(990, 8900) = 255.38                 Prob > F = 0.0000
r; t=0.07 15:14:49

.                         est store fe_firm
r; t=0.00 15:14:49

. 
.                 reghdfe lnwage educ exper exper2 i.year, absorb(FE1=workerid FE2=firmid)
you are using version 2.37.0 of ftools, but require version 2.39.1
r(9); t=0.00 15:14:49

end of do-file

r(9); t=3.77 15:14:49

. exit, clear
